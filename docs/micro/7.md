# 微前端方案对比

## 概述

随着前端应用规模的不断扩大,微前端架构已成为大型 Web 应用的主流解决方案。微前端允许将庞大的单体应用拆分为多个独立开发、独立部署的子应用,从而提升开发效率、降低维护成本。然而,不同的微前端方案在技术实现、性能表现和适用场景上存在显著差异。

本文将对目前主流的四种微前端方案进行深入对比分析:**qiankun**、**micro-app**、**EMP** 和 **无界(wujie)**,帮助开发者根据实际需求选择最合适的技术方案。

---

## qiankun 方案

### qiankun 方案简介

qiankun 是由蚂蚁金服开源的微前端框架,基于 single-spa 进行二次封装和增强。作为国内使用最广泛的微前端解决方案之一,qiankun 在 single-spa 的基础上提供了更完善的沙箱隔离、资源加载和应用通信能力。

### qiankun 核心特点

1. **HTML Entry 加载方式** - 采用 HTML 作为子应用入口,相比 JS Entry 方式大幅降低了应用改造成本,开发者无需手动处理资源依赖关系
2. **完备的沙箱隔离方案** - 提供三套渐进增强的 JS 沙箱方案(SnapshotSandbox、LegacySandbox、ProxySandbox),以及两套 CSS 沙箱方案(strictStyleIsolation、experimentalStyleIsolation),适配不同浏览器环境
3. **静态资源预加载** - 支持子应用资源预加载,优化首屏加载性能
4. **应用间通信机制** - 提供基于发布-订阅模式的全局状态管理方案

### qiankun 主要不足

1. **较高的适配成本** - 需要对子应用的工程化配置、生命周期、静态资源路径、路由系统等进行一系列适配改造
2. **沙箱性能问题** - CSS 严格隔离模式(Shadow DOM)在某些场景下存在兼容性问题,JS 沙箱的 Proxy 拦截在高频操作时性能下降明显
3. **应用激活限制** - 不支持同时激活多个子应用,也不支持子应用保活(keep-alive)
4. **现代构建工具支持不足** - 无法直接支持 Vite 等基于 ESM 的构建工具,需要额外配置

---

## micro-app 方案

### micro-app 方案简介

micro-app 是京东开源的微前端框架,采用 Web Components 技术加载子应用,并复用了 qiankun 经过验证的沙箱机制。该方案将微前端能力封装为类似 Web Components 的自定义元素,提供更符合前端开发习惯的组件化 API。

### micro-app 核心特点

1. **Web Components 加载机制** - 使用自定义元素(`<micro-app>`)加载子应用,相比 single-spa 的注册监听方案更加简洁优雅
2. **成熟的沙箱机制** - 复用经过大量项目验证的 qiankun 沙箱方案,保证了框架的稳定性和可靠性
3. **组件化 API 设计** - 提供类似 Vue/React 组件的使用方式,降低学习成本,支持子应用保活
4. **降低接入成本** - 简化子应用改造流程,提供静态资源预加载能力

### micro-app 主要不足

1. **路由依赖问题** - 虽然接入成本较 qiankun 有所降低,但主子应用间的路由依然存在耦合
2. **路由状态丢失** - 多应用激活后,刷新页面会导致所有子应用的路由状态丢失
3. **沙箱隔离不彻底** - CSS 沙箱仍无法做到绝对隔离,JS 沙箱虽然通过全局变量查找缓存优化了性能,但仍存在边界情况
4. **Vite 支持受限** - 虽然支持 Vite 运行,但必须使用专用插件改造子应用,且 JS 代码无法进行沙箱隔离
5. **浏览器兼容性** - 对于不支持 Web Components 的旧版浏览器缺少降级处理方案

---

## EMP 方案

### EMP 方案简介

EMP(Electron Micro Platform)是基于 Webpack 5 Module Federation(模块联邦)特性的微前端解决方案。该方案利用 Webpack 5 的原生能力实现应用间的模块共享和动态加载,是一种编译时的微前端方案。

### EMP 核心特点

1. **模块联邦编译** - 利用 Webpack 5 Module Federation 实现子应用依赖解耦,在构建时确定模块共享关系
2. **去中心化架构** - 应用间可以相互调用和共享模块,无需中心化的主应用协调
3. **TypeScript 支持** - 提供远程模块的 TypeScript 类型支持,保证类型安全
4. **共享依赖优化** - 自动处理公共依赖的共享和版本协调,减少重复加载

### EMP 主要不足

1. **强依赖 Webpack 5** - 必须使用 Webpack 5 作为构建工具,对老旧项目和使用其他构建工具的项目不友好
2. **缺少沙箱隔离** - 没有提供有效的 CSS 和 JS 沙箱机制,应用间隔离需要开发者自行保证
3. **功能限制** - 不支持子应用保活和多应用同时激活
4. **路由处理不明确** - 官方文档对主子应用路由合并处理的说明不够清晰

---

## 无界(wujie)方案

### 无界方案简介

无界是腾讯开源的新一代微前端框架,采用 **Web Components 容器 + iframe 沙箱** 的创新架构。该方案充分利用 iframe 的天然隔离特性,同时通过 Web Components 解决 iframe 的传统缺陷,实现了性能和隔离性的完美平衡。

### 无界核心特点

1. **iframe 天然沙箱** - 利用 iframe 提供完全隔离的 JS 和 CSS 运行环境,无需额外的沙箱实现
2. **Web Components 容器** - 通过自定义元素承载子应用,解决 iframe 的路由同步、DOM 结构等问题
3. **完善的应用通信** - 提供多种通信方式,包括 props 传递、事件总线、共享状态等
4. **子应用保活** - 支持子应用的 keep-alive 能力,切换应用时保持状态
5. **多应用激活** - 支持同时激活多个子应用,适用于复杂的业务场景
6. **零改造接入** - 子应用几乎无需改造即可接入,适配成本极低
7. **原生支持 Vite** - 完美支持 Vite 等 ESM 构建工具,无需额外配置
8. **预加载和预执行** - 提供资源预加载和应用预执行能力,优化加载性能

### 主要优势

- **样式隔离彻底** - iframe 提供天然的样式隔离,无需担心样式冲突
- **运行性能优秀** - 避免了 Proxy 沙箱的性能开销,运行效率更高
- **无白屏问题** - 通过预加载和保活机制,有效解决子应用切换时的白屏问题
- **应用共享** - 支持多个主应用共享同一个子应用实例

---

## 方案对比总结

### 技术演进分析

- **qiankun** 在 single-spa 基础上做了重大改进,引入了 HTML Entry 和完善的沙箱机制,但仍存在性能和兼容性问题
- **micro-app** 通过 Web Components 优化了使用体验,但继承了 qiankun 沙箱的固有问题
- **EMP** 基于 Webpack 5 Module Federation 提供了编译时方案,但受限于构建工具的强依赖
- **无界** 采用 iframe + Web Components 的创新架构,在隔离性、性能和易用性上实现了突破

### 方案选择建议

| 场景                  | 推荐方案        | 理由                               |
| :-------------------- | :-------------- | :--------------------------------- |
| 新项目,追求最佳体验   | **无界(wujie)** | 零改造成本、完善的隔离、优秀的性能 |
| 已有 qiankun 项目     | **qiankun**     | 保持技术栈一致,迁移成本低          |
| 使用 Webpack 5 的项目 | **EMP**         | 利用 Module Federation 原生能力    |
| 需要组件化 API        | **micro-app**   | 提供类似组件的使用方式             |
| 对 Vite 有强需求      | **无界(wujie)** | 原生支持 ESM 和 Vite               |

### 未来趋势

截至 2025 年,微前端技术仍在快速发展中:

- **性能优化** - 各方案都在持续优化加载性能和运行时性能
- **现代化工具支持** - 对 Vite、Turbopack 等新一代构建工具的支持成为标配
- **标准化** - W3C 正在推进微前端相关的 Web 标准制定
- **AI 辅助** - 开始探索 AI 辅助的微前端应用编排和优化

总体而言,**无界(wujie)** 凭借其创新的架构设计和优秀的综合表现,正在成为新项目的首选方案。而对于已有项目,则需要根据现有技术栈和业务需求进行权衡选择。

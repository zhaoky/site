<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>基于 MCP 的智能 API 文档查询服务开发实践 | korey的前端笔记</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.0.0-rc.34">
    <link rel="preload stylesheet" href="/assets/style.BeXA865a.css" as="style">
    
    <script type="module" src="/assets/app.DaSxsthp.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Dxoqk0BT.js">
    <link rel="modulepreload" href="/assets/chunks/theme.2UKSkhqM.js">
    <link rel="modulepreload" href="/assets/chunks/katex.BbEIqZs1.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-6UL2VRFP.DhgG4cn0.js">
    <link rel="modulepreload" href="/assets/chunks/cose-bilkent-S5V4N54A.D2AsXqLR.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-YG6GDRKO.DqYFh5UZ.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-NV44I4VS.DbZk7hW9.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-Q2GNP2WA.DtZC0oJb.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-NY62KEGX.BmdBTyvQ.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-LVOFAZNH.CbBfmC48.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-F6ZHWCRC.ChlviA-z.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-ADFJNKIX.BLJtSv0h.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-AYHSOK5B.CCXdHRmt.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-PRI3JC2R.B4DOU5Y2.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-UZGBJVZJ.W11aLsbA.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-WL72ISMW.DyxhX6F0.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-2ON5EDUG.CNu54CiF.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-WZHVMYZB.CNu54CiF.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-FKZM4ZOC.CH4kWW_0.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-4FDKWEC3.Cgktc4Mp.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-XKPGCS4Q.BFaNvTsz.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-IT6M3QCI.C84UwnWf.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-VGOIOE7T.B93JYqVy.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-3W4ZIXB7.DmdsPk3a.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-TZEHDZUN.CWFFgeHi.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-S2PKOQOG.CKBCg8DS.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-QEK2KX5R.BTIWwfgn.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-VD42YOAC.D06L757W.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-VXUJARFQ.Da7OIzWv.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-PSM6KHXK.DA4jsMet.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_pwa-register.BM_v7nji.js">
    <link rel="modulepreload" href="/assets/ai_7.md.B15PXkWV.lean.js">
    <script async src="https://www.googletagmanager.com/gtm.js?id=GTM-5XFW3W37"></script>
    <script>window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":new Date().getTime(),event:"gtm.js"});</script>
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?5aebbee438df8a51319ffb8c6c6a53c7";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <link rel="icon" href="/base/avatar.jpg">
    <link rel="apple-touch-icon" href="/base/avatar.jpg">
    <meta name="author" content="korey">
    <meta name="keywords" content="Korey的知识库, 知识库, 博客">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#f6f6f7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="korey的前端笔记">
    <meta property="og:description" content="">
    <meta property="og:site" content="https://korey.cc">
    <meta property="og:site_name" content="korey的前端笔记">
    <meta property="og:image" content="/base/avatar.jpg">
    <meta name="referrer" content="no-referrer">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="manifest" href="/manifest.webmanifest">
  </head>
  <body>
    <div id="app"><!--[--><div class="Layout" data-v-c7229e1b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-7e7d3566></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-7e7d3566> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c7229e1b data-v-1c288fd2><div class="VPNavBar" data-v-1c288fd2 data-v-303b7a9d><div class="wrapper" data-v-303b7a9d><div class="container" data-v-303b7a9d><div class="title" data-v-303b7a9d><div class="VPNavBarTitle has-sidebar" data-v-303b7a9d data-v-d84a190d><a class="title" href="/" data-v-d84a190d><!--[--><!--]--><!--[--><img class="VPImage logo" src="/base/avatar.jpg" alt data-v-f0a74bbd><!--]--><!--[-->korey的前端笔记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-303b7a9d><div class="content-body" data-v-303b7a9d><!--[--><!--]--><div class="VPNavBarSearch search" data-v-303b7a9d><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-303b7a9d data-v-5329cc72><span id="main-nav-aria-label" class="visually-hidden" data-v-5329cc72>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/ai/1" tabindex="0" data-v-5329cc72 data-v-decd170e><!--[--><span data-v-decd170e>AI</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/micro/999" tabindex="0" data-v-5329cc72 data-v-decd170e><!--[--><span data-v-decd170e>微前端</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-5329cc72 data-v-4ff49fe7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4ff49fe7><span class="text" data-v-4ff49fe7><!----><span data-v-4ff49fe7>经验沉淀</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-4ff49fe7><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-4ff49fe7><div class="VPMenu" data-v-4ff49fe7 data-v-563396ec><div class="items" data-v-563396ec><!--[--><!--[--><div class="VPMenuLink" data-v-563396ec data-v-43026108><a class="VPLink link" href="/exp/javascript/101" data-v-43026108><!--[-->javascript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-563396ec data-v-43026108><a class="VPLink link" href="/exp/css/186" data-v-43026108><!--[-->css<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-563396ec data-v-43026108><a class="VPLink link" href="/exp/misc/336" data-v-43026108><!--[-->misc<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-5329cc72 data-v-4ff49fe7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4ff49fe7><span class="text" data-v-4ff49fe7><!----><span data-v-4ff49fe7>源码系列</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-4ff49fe7><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-4ff49fe7><div class="VPMenu" data-v-4ff49fe7 data-v-563396ec><div class="items" data-v-563396ec><!--[--><!--[--><div class="VPMenuLink" data-v-563396ec data-v-43026108><a class="VPLink link" href="/code/webpack4/372" data-v-43026108><!--[-->webpack 4<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-563396ec data-v-43026108><a class="VPLink link" href="/code/vue2/392" data-v-43026108><!--[-->vue 2<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/misc/237" tabindex="0" data-v-5329cc72 data-v-decd170e><!--[--><span data-v-decd170e>其他杂项</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/links/index" tabindex="0" data-v-5329cc72 data-v-decd170e><!--[--><span data-v-decd170e>更多</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-303b7a9d data-v-761088aa><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-761088aa data-v-425dd4be data-v-af68f0c6><span class="check" data-v-af68f0c6><span class="icon" data-v-af68f0c6><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-425dd4be><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-425dd4be><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-303b7a9d data-v-71fe0af9 data-v-69377c6a><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zhaoky" aria-label="github" target="_blank" rel="noopener" data-v-69377c6a data-v-83ddaeac><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-303b7a9d data-v-fc5f18b2 data-v-4ff49fe7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4ff49fe7><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4ff49fe7><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-4ff49fe7><div class="VPMenu" data-v-4ff49fe7 data-v-563396ec><!----><!--[--><!--[--><!----><div class="group" data-v-fc5f18b2><div class="item appearance" data-v-fc5f18b2><p class="label" data-v-fc5f18b2>Appearance</p><div class="appearance-action" data-v-fc5f18b2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-fc5f18b2 data-v-425dd4be data-v-af68f0c6><span class="check" data-v-af68f0c6><span class="icon" data-v-af68f0c6><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-425dd4be><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-425dd4be><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-fc5f18b2><div class="item social-links" data-v-fc5f18b2><div class="VPSocialLinks social-links-list" data-v-fc5f18b2 data-v-69377c6a><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zhaoky" aria-label="github" target="_blank" rel="noopener" data-v-69377c6a data-v-83ddaeac><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-303b7a9d data-v-7de2f007><span class="container" data-v-7de2f007><span class="top" data-v-7de2f007></span><span class="middle" data-v-7de2f007></span><span class="bottom" data-v-7de2f007></span></span></button></div></div></div></div><div class="divider" data-v-303b7a9d><div class="divider-line" data-v-303b7a9d></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-c7229e1b data-v-a6501e83><div class="container" data-v-a6501e83><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6501e83><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-a6501e83><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-a6501e83>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6501e83 data-v-50636c9f><button data-v-50636c9f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-c7229e1b data-v-e991766f><div class="curtain" data-v-e991766f></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-e991766f><span class="visually-hidden" id="sidebar-aria-label" data-v-e991766f> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-e991766f><section class="VPSidebarItem level-0 has-active" data-v-e991766f data-v-854bdee5><div class="item" role="button" tabindex="0" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><h2 class="text" data-v-854bdee5>AI</h2><!----></div><div class="items" data-v-854bdee5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/1" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>AI 技术架构对比：RAG、Function Calling、MCP 与 AI Agent 深度解析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/2" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>深入剖析 WebAPI 的作用以及 n8n 和 Dify 的核心区别与最佳应用场景</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/3" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>AI 在实际生产环境中的提效实践 - 详细总结</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/4" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>AI 编程工具全景分析：2025 年发展现状与趋势</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/5" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>前端自建 MCP 服务连接框架文档指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/6" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>AI Agent 构建实战指南详解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/7" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>基于 MCP 的智能 API 文档查询服务开发实践</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-854bdee5 data-v-854bdee5><div class="item" data-v-854bdee5><div class="indicator" data-v-854bdee5></div><a class="VPLink link link" href="/ai/8" data-v-854bdee5><!--[--><p class="text" data-v-854bdee5>AI 对话的实现与难点解析</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c7229e1b data-v-7d0749bf><div class="VPDoc has-sidebar has-aside" data-v-7d0749bf data-v-87deb3fa><!--[--><!--]--><div class="container" data-v-87deb3fa><div class="aside" data-v-87deb3fa><div class="aside-curtain" data-v-87deb3fa></div><div class="aside-container" data-v-87deb3fa><div class="aside-content" data-v-87deb3fa><div class="VPDocAside" data-v-87deb3fa data-v-494c03c0><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-494c03c0 data-v-cbfec593><div class="content" data-v-cbfec593><div class="outline-marker" data-v-cbfec593></div><div class="outline-title" role="heading" aria-level="2" data-v-cbfec593>本文大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-cbfec593><span class="visually-hidden" id="doc-outline-aria-label" data-v-cbfec593> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-cbfec593 data-v-c6a947da><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-494c03c0></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-87deb3fa><div class="content-container" data-v-87deb3fa><!--[--><!--]--><main class="main" data-v-87deb3fa><div style="position:relative;" class="vp-doc _ai_7" data-v-87deb3fa><div><h1 id="基于-mcp-的智能-api-文档查询服务开发实践" tabindex="-1">基于 MCP 的智能 API 文档查询服务开发实践 <a class="header-anchor" href="#基于-mcp-的智能-api-文档查询服务开发实践" aria-label="Permalink to &quot;基于 MCP 的智能 API 文档查询服务开发实践&quot;">​</a></h1><h2 id="一、服务概述" tabindex="-1">一、服务概述 <a class="header-anchor" href="#一、服务概述" aria-label="Permalink to &quot;一、服务概述&quot;">​</a></h2><h3 id="_1-1-背景与痛点" tabindex="-1">1.1 背景与痛点 <a class="header-anchor" href="#_1-1-背景与痛点" aria-label="Permalink to &quot;1.1 背景与痛点&quot;">​</a></h3><p>在现代前端开发中，我们经常面临这样的场景：</p><ul><li><strong>AI 无法访问内网</strong>：YApi 等文档平台部署在内网，AI 助手无法直接访问</li><li><strong>文档查询繁琐</strong>：需要频繁切换到 YApi 平台查找接口定义，打断开发思路</li><li><strong>新人上手成本高</strong>：需要熟悉大量接口文档才能开始工作</li></ul><h3 id="_1-2-解决方案" tabindex="-1">1.2 解决方案 <a class="header-anchor" href="#_1-2-解决方案" aria-label="Permalink to &quot;1.2 解决方案&quot;">​</a></h3><p>本项目实现了一个基于 <strong>MCP (Model Context Protocol)</strong> 的 API 文档查询服务，作为 AI 助手访问内网 YApi 的桥梁，让 AI 能够按需获取和理解后端接口文档。</p><p><strong>MCP</strong> 是由 Anthropic 推出的开放协议，旨在让 AI 模型能够安全地访问外部数据源和工具。通过 MCP，AI 助手可以：</p><ul><li>突破内网限制，访问 YApi 文档</li><li>按需查询最新的 API 文档</li><li>理解接口的请求参数、响应结构</li><li>自动生成接口调用代码</li></ul><h3 id="_1-3-核心价值" tabindex="-1">1.3 核心价值 <a class="header-anchor" href="#_1-3-核心价值" aria-label="Permalink to &quot;1.3 核心价值&quot;">​</a></h3><div class="mermaid"></div><p>通过这个服务，开发者只需要告诉 AI：&quot;帮我实现这个接口&quot;，AI 就能自动：</p><ol><li>通过 MCP Server 访问内网 YApi</li><li>查询接口文档获取完整定义</li><li>理解请求参数和响应结构</li><li>生成接口调用代码</li></ol><h2 id="二、系统架构" tabindex="-1">二、系统架构 <a class="header-anchor" href="#二、系统架构" aria-label="Permalink to &quot;二、系统架构&quot;">​</a></h2><ul><li>技术栈：Python 3.12 | FastAPI | FastMCP | Docker | Nginx | SSE</li><li>开发环境：Docker | Docker Compose</li><li>文档系统：YApi（当前版本仅支持 YApi）</li><li>AI 平台：Cursor IDE</li><li>协议：MCP (Model Context Protocol)</li></ul><h3 id="_2-1-整体架构" tabindex="-1">2.1 整体架构 <a class="header-anchor" href="#_2-1-整体架构" aria-label="Permalink to &quot;2.1 整体架构&quot;">​</a></h3><p>系统采用经典的四层架构设计，每层职责清晰，便于维护和扩展：</p><div class="mermaid"></div><p><strong>架构说明：</strong></p><ul><li><strong>客户端层</strong>：Cursor IDE 通过配置文件声明 MCP 服务端点，建立连接后自动维持会话</li><li><strong>网络层</strong>：Nginx 作为反向代理，提供 HTTPS 加密、长连接保持、CORS 处理等功能</li><li><strong>应用层</strong>：FastAPI + FastMCP 实现 MCP 协议，AuthMiddleware 负责认证和会话管理</li><li><strong>数据层</strong>：YApi 作为接口文档的数据源，通过 RESTful API 提供文档查询能力</li></ul><h3 id="_2-2-技术选型" tabindex="-1">2.2 技术选型 <a class="header-anchor" href="#_2-2-技术选型" aria-label="Permalink to &quot;2.2 技术选型&quot;">​</a></h3><table><thead><tr><th>层级</th><th>技术</th><th>作用</th><th>选型理由</th></tr></thead><tbody><tr><td>通信协议</td><td>SSE (Server-Sent Events)</td><td>服务端主动推送，单向实时通信</td><td>原生 HTTP、自动重连、代理友好、满足 MCP 协议需求</td></tr><tr><td>Web 框架</td><td>FastAPI</td><td>高性能异步 Web 服务</td><td>原生异步支持、类型提示、自动文档生成</td></tr><tr><td>MCP 框架</td><td>FastMCP</td><td>MCP 协议快速实现</td><td>简化 MCP 开发、内置 SSE 支持、装饰器友好</td></tr><tr><td>容器化</td><td>Docker + Docker Compose</td><td>环境隔离与快速部署</td><td>一致性环境、一键部署、便于迁移</td></tr><tr><td>反向代理</td><td>Nginx</td><td>HTTPS 终止、长连接、负载均衡</td><td>高性能、稳定可靠、丰富的配置选项</td></tr><tr><td>HTTP 客户端</td><td>Requests + Session</td><td>HTTP 请求与会话保持</td><td>简单易用、Session 自动管理 Cookie</td></tr><tr><td>日志框架</td><td>Python logging</td><td>结构化日志记录</td><td>标准库、支持多种输出、便于调试</td></tr><tr><td>环境管理</td><td>python-dotenv</td><td>环境变量配置管理</td><td>开发/生产环境分离、敏感信息保护</td></tr></tbody></table><h2 id="三、核心技术模块" tabindex="-1">三、核心技术模块 <a class="header-anchor" href="#三、核心技术模块" aria-label="Permalink to &quot;三、核心技术模块&quot;">​</a></h2><h3 id="_3-1-认证与会话管理" tabindex="-1">3.1 认证与会话管理 <a class="header-anchor" href="#_3-1-认证与会话管理" aria-label="Permalink to &quot;3.1 认证与会话管理&quot;">​</a></h3><p>系统采用多层认证机制，确保安全性的同时保持良好的用户体验。核心解决了两个挑战：</p><ol><li><strong>多用户并发认证</strong>：不同开发者可能同时使用服务，需要隔离各自的登录状态</li><li><strong>长连接会话保持</strong>：SSE 连接和消息请求是分离的，需要关联它们的认证上下文</li></ol><h4 id="认证流程设计" tabindex="-1">认证流程设计 <a class="header-anchor" href="#认证流程设计" aria-label="Permalink to &quot;认证流程设计&quot;">​</a></h4><div class="mermaid"></div><h4 id="核心实现要点" tabindex="-1">核心实现要点 <a class="header-anchor" href="#核心实现要点" aria-label="Permalink to &quot;核心实现要点&quot;">​</a></h4><h4 id="_1-contextvar-跨协程共享认证信息" tabindex="-1">1. ContextVar 跨协程共享认证信息 <a class="header-anchor" href="#_1-contextvar-跨协程共享认证信息" aria-label="Permalink to &quot;1. ContextVar 跨协程共享认证信息&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">current_request_auth: ContextVar[Dict[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Optional[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ContextVar(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;current_request_auth&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;username&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>为什么使用 ContextVar？</strong></p><p>在异步 Web 应用中，多个请求可能并发处理。如果使用全局变量存储认证信息，会导致数据混乱：</p><ul><li><strong>全局变量</strong>：用户 A 的认证信息可能被用户 B 覆盖</li><li><strong>线程局部存储（threading.local）</strong>：在异步环境中不适用，因为多个请求可能在同一线程中处理</li><li><strong>ContextVar</strong>：为每个异步任务（协程）提供独立的上下文，天然支持异步并发</li></ul><p><code>ContextVar</code> 会在每个请求的整个处理链中自动传递，无需手动传参，同时保证不同请求之间的隔离。</p><h4 id="_2-session-缓存设计" tabindex="-1">2. Session 缓存设计 <a class="header-anchor" href="#_2-session-缓存设计" aria-label="Permalink to &quot;2. Session 缓存设计&quot;">​</a></h4><p>Session 缓存是系统性能优化的核心，避免频繁登录造成的性能问题和被限流风险。</p><div class="mermaid"></div><p><strong>缓存策略细节：</strong></p><ul><li><strong>时间过期检测</strong>：每次获取 Session 时检查 <code>time.time() - timestamp &gt; SESSION_EXPIRE_TIME</code></li><li><strong>状态过期检测</strong>：请求返回 401/403 时自动触发刷新</li><li><strong>线程安全</strong>：使用 <code>threading.Lock</code> 保护缓存字典的读写操作</li><li><strong>自动清理</strong>：过期的 Session 在检测时自动从缓存中移除</li></ul><p><strong>性能收益：</strong></p><p>假设 30 天过期时间，每天查询 50 次文档：</p><ul><li>传统方案：50 次登录 × 30 天 = 1500 次登录请求</li><li>缓存方案：1 次登录 + 50 次查询 × 30 天 = 仅 1 次登录</li></ul><p>登录请求减少 <strong>99.93%</strong>，同时避免了被接口限流的风险。</p><h4 id="_3-会话映射机制" tabindex="-1">3. 会话映射机制 <a class="header-anchor" href="#_3-会话映射机制" aria-label="Permalink to &quot;3. 会话映射机制&quot;">​</a></h4><p>MCP 协议中，SSE 连接建立后，后续的工具调用通过独立的 HTTP POST 请求发送到 <code>/mcp/messages/{session_id}</code>。这就带来一个问题：如何让消息请求知道是哪个用户发起的？</p><p>系统通过 <code>session_id → username</code> 映射解决这个问题：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session_username_mapping: Dict[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SSE 连接时：提供 username + password，建立初始认证</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 消息请求时：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - 首次：提供 username，建立映射 session_id → username</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - 后续：仅需 session_id，从映射中获取 username</span></span></code></pre></div><p><strong>映射生命周期：</strong></p><ol><li><strong>建立</strong>：首次 <code>/mcp/messages/{session_id}</code> 请求时，提取 username 并建立映射</li><li><strong>使用</strong>：后续请求直接使用 <code>session_username_mapping[session_id]</code> 获取用户名</li><li><strong>清理</strong>：监听 <code>http.disconnect</code> 事件，连接断开时自动删除映射</li></ol><p>这种设计让客户端在首次请求后无需重复传递 username，减少了数据传输量，同时保持了认证的安全性。</p><h3 id="_3-2-中间件设计" tabindex="-1">3.2 中间件设计 <a class="header-anchor" href="#_3-2-中间件设计" aria-label="Permalink to &quot;3.2 中间件设计&quot;">​</a></h3><p>自定义 <code>AuthMiddleware</code> 实现细粒度的请求拦截和处理。这是整个系统安全性和可靠性的核心保障。</p><p><strong>为什么需要自定义中间件？</strong></p><p>FastAPI 的依赖注入系统在 SSE 场景下有局限性：</p><ul><li>SSE 连接建立后保持开放，依赖注入只在初始阶段执行一次</li><li>后续消息请求需要独立的认证逻辑</li><li>需要在 ASGI 层面监听连接断开事件</li></ul><p>因此，我们实现了 ASGI 中间件，在更底层控制请求处理流程。</p><div class="mermaid"></div><h4 id="_1-异步连接监听" tabindex="-1">1. 异步连接监听 <a class="header-anchor" href="#_1-异步连接监听" aria-label="Permalink to &quot;1. 异步连接监听&quot;">​</a></h4><p>传统的请求-响应模式下，请求结束即释放资源。但 SSE 是长连接，如何知道客户端断开了？</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wrapped_receive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receive()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http.disconnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 客户端断开，清理 session_id 映射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cleanup_session(session_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 用包装后的 receive 替换原始的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.app(scope, wrapped_receive, send)</span></span></code></pre></div><p>通过包装 ASGI 的 <code>receive</code> 函数，我们能够监听 <code>http.disconnect</code> 事件，在客户端断开时立即清理资源，避免内存泄漏。</p><h4 id="_2-灵活的认证策略" tabindex="-1">2. 灵活的认证策略 <a class="header-anchor" href="#_2-灵活的认证策略" aria-label="Permalink to &quot;2. 灵活的认证策略&quot;">​</a></h4><p>不同端点有不同的认证需求：</p><table><thead><tr><th>端点</th><th>认证要求</th><th>原因</th></tr></thead><tbody><tr><td><code>/mcp/sse</code></td><td>username + password</td><td>初始连接，需要完整认证并登录</td></tr><tr><td><code>/mcp/messages</code> (首次)</td><td>session_id + username</td><td>建立会话映射</td></tr><tr><td><code>/mcp/messages</code> (后续)</td><td>仅 session_id</td><td>从映射获取用户，减少传输</td></tr><tr><td><code>/mcp/health</code></td><td>无需认证</td><td>健康检查应该始终可访问</td></tr></tbody></table><p>这种分层认证既保证了安全性，又优化了性能和用户体验。</p><h4 id="_3-详细的日志追踪" tabindex="-1">3. 详细的日志追踪 <a class="header-anchor" href="#_3-详细的日志追踪" aria-label="Permalink to &quot;3. 详细的日志追踪&quot;">​</a></h4><p>每个关键步骤都有结构化日志：</p><ul><li><strong>INFO</strong>：正常流程（连接建立、Session 缓存命中、文档获取成功）</li><li><strong>WARNING</strong>：可恢复异常（Session 过期、自动重登）</li><li><strong>ERROR</strong>：严重错误（认证失败、接口异常）</li></ul><p>日志包含用户名、session_id、客户端 IP 等上下文信息，便于追踪问题和性能分析。</p><h3 id="_3-3-数据处理流水线" tabindex="-1">3.3 数据处理流水线 <a class="header-anchor" href="#_3-3-数据处理流水线" aria-label="Permalink to &quot;3.3 数据处理流水线&quot;">​</a></h3><p>从用户输入 URL 到返回格式化文档，系统经历了一系列智能化的数据处理步骤。</p><div class="mermaid"></div><h4 id="_1-url-自动转换" tabindex="-1">1. URL 自动转换 <a class="header-anchor" href="#_1-url-自动转换" aria-label="Permalink to &quot;1. URL 自动转换&quot;">​</a></h4><p>YApi 的页面 URL 和 API URL 格式不同，系统智能识别并转换：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> convert_to_api_url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(page_url: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;支持页面 URL 和 API URL 两种输入格式&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 输入：http://domain.com/project/123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 输出：http://domain.com/api/interface/get?id=123</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 输入：http://domain.com/api/interface/get?id=123</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 输出：原样返回（已经是 API URL）</span></span></code></pre></div><p>开发者通常复制的是 YApi 页面 URL，系统自动识别并转换为 API URL，避免手动转换的繁琐和错误。</p><h4 id="_2-json-schema-美化" tabindex="-1">2. JSON Schema 美化 <a class="header-anchor" href="#_2-json-schema-美化" aria-label="Permalink to &quot;2. JSON Schema 美化&quot;">​</a></h4><p>YApi 返回的请求体和响应体是 JSON 字符串，直接展示不易阅读：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parse_json_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema_str: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;解析并美化 JSON Schema&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.loads(schema_str)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.dumps(schema, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">indent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ensure_ascii</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (json.JSONDecodeError, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TypeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> schema_str  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解析失败时返回原始字符串</span></span></code></pre></div><h4 id="_3-批量查询支持" tabindex="-1">3. 批量查询支持 <a class="header-anchor" href="#_3-批量查询支持" aria-label="Permalink to &quot;3. 批量查询支持&quot;">​</a></h4><p>AI 可以一次性查询多个接口文档：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch_api_docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;支持单个 URL 或 URL 列表&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    urls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [url]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 批量获取并合并结果</span></span></code></pre></div><h3 id="_3-4-错误处理与重试" tabindex="-1">3.4 错误处理与重试 <a class="header-anchor" href="#_3-4-错误处理与重试" aria-label="Permalink to &quot;3.4 错误处理与重试&quot;">​</a></h3><p>系统设计了完善的错误处理和自动重试机制，确保高可用性和良好的用户体验。</p><div class="mermaid"></div><p><strong>重试策略：</strong></p><p>系统通过两层检测机制（业务层 errcode 和 HTTP 状态码）自动识别 Session 过期，并自动刷新重试，用户完全无感知。</p><p><strong>容错边界：</strong></p><table><thead><tr><th>错误类型</th><th>处理方式</th><th>用户影响</th></tr></thead><tbody><tr><td>Session 过期</td><td>自动刷新并重试</td><td>零感知</td></tr><tr><td>网络临时故障</td><td>抛出异常，显示错误信息</td><td>看到错误提示</td></tr><tr><td>接口不存在</td><td>返回友好错误信息</td><td>看到错误提示</td></tr><tr><td>YApi 服务不可用</td><td>抛出异常</td><td>看到错误提示</td></tr></tbody></table><p>只有 Session 过期这类可恢复的错误才会自动重试，其他错误直接返回，避免无意义的重试浪费资源。</p><h3 id="_3-5-通信协议选择" tabindex="-1">3.5 通信协议选择 <a class="header-anchor" href="#_3-5-通信协议选择" aria-label="Permalink to &quot;3.5 通信协议选择&quot;">​</a></h3><p><strong>为什么使用 SSE (Server-Sent Events)？</strong></p><p>MCP 协议支持多种传输方式，对比分析后选择了 SSE：</p><table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用性</th></tr></thead><tbody><tr><td>HTTP 轮询</td><td>实现简单</td><td>资源浪费、延迟高</td><td>❌ 不适用</td></tr><tr><td>WebSocket</td><td>真正的双向通信、低延迟</td><td>协议复杂、代理支持差</td><td>🔶 过度设计</td></tr><tr><td>SSE</td><td>原生 HTTP、自动重连</td><td>仅支持单向推送</td><td>✅ 最佳选择</td></tr></tbody></table><p><strong>SSE 的核心优势：</strong></p><ul><li><strong>原生 HTTP</strong>：基于标准 HTTP 协议，无需特殊握手，代理友好</li><li><strong>自动重连</strong>：连接断开后浏览器自动重新连接</li><li><strong>满足需求</strong>：MCP 是&quot;请求-响应&quot;模式，不需要服务端主动推送，单向通信足够</li><li><strong>简单实现</strong>：服务端只需设置 <code>Content-Type: text/event-stream</code></li></ul><h3 id="_3-6-异步资源清理" tabindex="-1">3.6 异步资源清理 <a class="header-anchor" href="#_3-6-异步资源清理" aria-label="Permalink to &quot;3.6 异步资源清理&quot;">​</a></h3><p><strong>核心挑战：</strong> SSE 长连接可能持续数天，客户端随时可能断开，如何及时清理资源？</p><p><strong>解决方案：</strong> 包装 ASGI <code>receive</code> 函数监听断开事件</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wrapped_receive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receive()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http.disconnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cleanup_session(session_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.app(scope, wrapped_receive, send)</span></span></code></pre></div><p>通过监听 <code>http.disconnect</code> 事件，在客户端断开时立即清理 <code>session_id → username</code> 映射，确保：</p><ul><li><strong>及时清理</strong>：连接断开立即释放资源</li><li><strong>避免内存泄漏</strong>：映射字典不会无限增长</li><li><strong>准确追踪</strong>：日志记录活跃会话数，便于监控</li></ul><h2 id="四、部署架构" tabindex="-1">四、部署架构 <a class="header-anchor" href="#四、部署架构" aria-label="Permalink to &quot;四、部署架构&quot;">​</a></h2><h3 id="_4-1-容器化部署" tabindex="-1">4.1 容器化部署 <a class="header-anchor" href="#_4-1-容器化部署" aria-label="Permalink to &quot;4.1 容器化部署&quot;">​</a></h3><p>采用 Docker 容器化部署，实现&quot;一次构建，到处运行&quot;的目标。</p><div class="mermaid"></div><p><strong>容器化优势：</strong> 环境一致性、快速部署、资源隔离、易于迁移。</p><h4 id="dockerfile-设计要点" tabindex="-1">Dockerfile 设计要点 <a class="header-anchor" href="#dockerfile-设计要点" aria-label="Permalink to &quot;Dockerfile 设计要点&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> python:3.12-slim  # 使用精简版本，减小镜像体积</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置国内 pip 镜像源，加速依赖安装</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 分层构建：先复制 requirements.txt，利用 Docker 缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requirements.txt .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip install --no-cache-dir -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 最后复制应用代码，避免代码变更导致依赖重装</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api-docs-mcp-server.py .</span></span></code></pre></div><p>镜像优化：使用 slim 镜像、禁用 pip 缓存、分层构建利用缓存。</p><h4 id="docker-compose-配置要点" tabindex="-1">Docker Compose 配置要点 <a class="header-anchor" href="#docker-compose-配置要点" aria-label="Permalink to &quot;Docker Compose 配置要点&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SESSION_EXPIRE_TIME=2592000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 30天，平衡安全性和便利性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SERVER_HOST=0.0.0.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 监听所有网卡，允许外部访问</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SERVER_PORT=8000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 容器内端口</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;9527:8000&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 宿主机:容器，对外暴露 9527</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./static:/app/static</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 挂载静态文件目录（可选）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CMD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;curl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-f&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000/mcp/health&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 每 30 秒检查一次</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 超时时间 10 秒</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 失败 3 次后标记为 unhealthy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 异常退出时自动重启</span></span></code></pre></div><p>健康检查确保服务高可用：连续 3 次失败自动重启容器。</p><h3 id="_4-2-nginx-配置解析" tabindex="-1">4.2 Nginx 配置解析 <a class="header-anchor" href="#_4-2-nginx-配置解析" aria-label="Permalink to &quot;4.2 Nginx 配置解析&quot;">​</a></h3><p>Nginx 作为反向代理，承担了 HTTPS 终止、长连接保持、CORS 处理等重要职责。SSE 长连接对 Nginx 配置有特殊要求。</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /mcp/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 核心配置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:9527/mcp/;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_http_version </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1.1;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # SSE 关键配置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_buffering </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">off;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用缓冲</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_cache </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">off;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    chunked_transfer_encoding </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">on;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 分块传输</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 超长超时</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_connect_timeout </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">7d;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_send_timeout </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">7d;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_read_timeout </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">7d;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # CORS 支持</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Origin </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Methods </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET, POST, OPTIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>为什么需要这些配置？</strong></p><table><thead><tr><th>配置项</th><th>原因</th><th>不配置的后果</th></tr></thead><tbody><tr><td><code>proxy_buffering off</code></td><td>SSE 需要实时推送，缓冲会阻塞数据流</td><td>消息延迟，甚至完全无法接收</td></tr><tr><td><code>proxy_cache off</code></td><td>禁用缓存，确保实时数据</td><td>可能缓存旧数据，导致信息不一致</td></tr><tr><td><code>7d</code> 超时</td><td>SSE 连接是长连接，需要保持数周不断开</td><td>连接频繁断开，用户体验差</td></tr><tr><td><code>chunked_transfer_encoding on</code></td><td>支持流式传输，避免等待完整响应</td><td>无法流式传输，SSE 无法工作</td></tr><tr><td><code>Connection &#39;&#39;</code></td><td>清除 Connection 头，保持连接持久化</td><td>连接可能被提前关闭</td></tr><tr><td><code>proxy_http_version 1.1</code></td><td>HTTP/1.1 才支持长连接</td><td>默认 HTTP/1.0 不支持长连接</td></tr></tbody></table><p><strong>CORS 配置说明：</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Origin </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Methods </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET, POST, OPTIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Headers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type, Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><p>允许跨域访问，<code>always</code> 确保错误响应也携带 CORS 头（否则浏览器会报 CORS 错误而非真实错误）。</p><p><strong>性能优化配置：</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_max_body_size </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10M;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 允许上传 10MB 大小的请求体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_body_buffer_size </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10M;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 缓冲区大小，避免写入临时文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 传递真实 IP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 传递代理链</span></span></code></pre></div><h3 id="_4-3-部署流程" tabindex="-1">4.3 部署流程 <a class="header-anchor" href="#_4-3-部署流程" aria-label="Permalink to &quot;4.3 部署流程&quot;">​</a></h3><div class="mermaid"></div><p><strong>完整部署步骤：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 1：克隆代码（如果尚未克隆）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">repository-ur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project/tools/mcp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 2：创建 .env 文件（可选，也可以在 docker-compose.yml 中配置）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">API_USERNAME=your-email@example.com</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">API_PASSWORD=your-password</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">LOGIN_URL=https://yapi.your-domain.com/api/user/login</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SESSION_EXPIRE_TIME=2592000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SERVER_HOST=0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SERVER_PORT=8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 3：构建并启动容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 4：查看启动日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-docs-mcp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 5：验证服务健康</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9527/mcp/health</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 6：配置 Nginx（参考前文配置）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/your-domain.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 步骤 7：验证 HTTPS 访问</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://your-domain.com/mcp/health</span></span></code></pre></div><p><strong>常用运维命令：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看容器状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看实时日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 更新代码后重新部署</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入容器调试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-docs-mcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span></code></pre></div><h2 id="五、客户端配置" tabindex="-1">五、客户端配置 <a class="header-anchor" href="#五、客户端配置" aria-label="Permalink to &quot;五、客户端配置&quot;">​</a></h2><h3 id="_5-1-mcp-json-配置" tabindex="-1">5.1 mcp.json 配置 <a class="header-anchor" href="#_5-1-mcp-json-配置" aria-label="Permalink to &quot;5.1 mcp.json 配置&quot;">​</a></h3><p>Cursor IDE 通过 <code>~/.cursor/mcp.json</code> 文件配置 MCP 服务器连接：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;api-docs-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;获取惠灏后端接口API文档的MCP服务&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://base-quake.huihaohealth.com/mcp/sse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-password&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>配置项说明：</strong></p><ul><li><code>api-docs-server</code>：服务器名称，自定义标识符</li><li><code>comment</code>：注释说明，帮助理解服务用途</li><li><code>url</code>：MCP SSE 端点地址，必须是 <code>/mcp/sse</code> 路径</li><li><code>headers</code>：认证信息，在每个请求中自动携带 <ul><li><code>username</code>：YApi 登录邮箱</li><li><code>password</code>：YApi 登录密码</li></ul></li></ul><p><strong>安全建议：</strong> 设置文件权限为 600，不要提交到版本控制，定期更换密码。</p><p><strong>多环境配置：</strong></p><p>可以配置多个 MCP 服务器：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;api-docs-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://prod-api-docs.example.com/mcp/sse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod-pass&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;api-docs-test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://test-api-docs.example.com/mcp/sse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test-pass&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>AI 会自动发现所有配置的 MCP 服务器，你可以指定使用哪一个。</p><h3 id="_5-2-使用工作流" tabindex="-1">5.2 使用工作流 <a class="header-anchor" href="#_5-2-使用工作流" aria-label="Permalink to &quot;5.2 使用工作流&quot;">​</a></h3><p>完整的用户使用流程如下：</p><div class="mermaid"></div><p><strong>实际使用示例：</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>开发者：@https://yapi.example.com/project/interface/api/12345 帮我实现这个接口</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AI：正在查询接口文档...</span></span>
<span class="line"><span>    [调用 MCP fetch_api_docs 工具]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    我已经查询到接口文档，这是一个用户登录接口：</span></span>
<span class="line"><span>    - 请求方式：POST /api/user/login</span></span>
<span class="line"><span>    - 请求参数：email, password</span></span>
<span class="line"><span>    - 响应：包含 token 和用户信息</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    以下是实现代码：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 用户登录</span></span>
<span class="line"><span>     * @param {Object} params - 登录参数</span></span>
<span class="line"><span>     * @param {string} params.email - 用户邮箱</span></span>
<span class="line"><span>     * @param {string} params.password - 用户密码</span></span>
<span class="line"><span>     * @returns {Promise&lt;{token: string, userInfo: object}&gt;}</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    export const userLogin = params =&gt; {</span></span>
<span class="line"><span>      return api.post(&#39;/api/user/login&#39;, params)</span></span>
<span class="line"><span>    }</span></span></code></pre></div><p><strong>使用技巧：</strong></p><ol><li><strong>直接粘贴 URL</strong>：从浏览器地址栏复制 YApi 页面 URL 即可，无需转换</li><li><strong>批量查询</strong>：<code>@url1 @url2 @url3 帮我实现这些接口</code></li><li><strong>追加需求</strong>：<code>需要加上 Mock 数据支持</code></li><li><strong>修改代码</strong>：<code>改用 async/await 语法</code></li></ol><h2 id="六、监控与运维" tabindex="-1">六、监控与运维 <a class="header-anchor" href="#六、监控与运维" aria-label="Permalink to &quot;六、监控与运维&quot;">​</a></h2><h3 id="_6-1-日志体系" tabindex="-1">6.1 日志体系 <a class="header-anchor" href="#_6-1-日志体系" aria-label="Permalink to &quot;6.1 日志体系&quot;">​</a></h3><p>完善的日志体系是系统可观测性的基础。系统实现了分层次、结构化的日志记录。</p><div class="mermaid"></div><p><strong>日志格式设计：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logging.basicConfig(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logging.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%(asctime)s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] [MCP][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%(levelname)s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%(message)s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    datefmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;%Y-%m-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %H:%M:%S&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><strong>时间戳</strong>：便于追踪问题发生时间</li><li><strong>标签 [MCP]</strong>：区分不同服务的日志</li><li><strong>日志级别</strong>：INFO/WARNING/ERROR，快速定位问题严重程度</li><li><strong>结构化信息</strong>：用户名、IP、session_id 等关键信息</li></ul><p><strong>完整日志示例：</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>[2025-11-14 10:00:00] [MCP][INFO] === SSE 连接请求 === 客户端IP: 192.168.1.100, 用户: user@example.com</span></span>
<span class="line"><span>[2025-11-14 10:00:01] [MCP][INFO] 执行登录（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:00:02] [MCP][INFO] 登录成功（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:00:02] [MCP][INFO] Session 已缓存（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:00:03] [MCP][INFO] SSE 连接已建立（用户: user@example.com）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[2025-11-14 10:01:00] [MCP][INFO] 请求路径: /mcp/messages/abc123, 用户: user@example.com, session_id: abc123</span></span>
<span class="line"><span>[2025-11-14 10:01:00] [MCP][INFO] 建立会话映射: abc123 -&gt; user@example.com</span></span>
<span class="line"><span>[2025-11-14 10:01:00] [MCP][INFO] 当前活跃会话数: 1</span></span>
<span class="line"><span>[2025-11-14 10:01:01] [MCP][INFO] 准备获取 1 个文档</span></span>
<span class="line"><span>[2025-11-14 10:01:01] [MCP][INFO] 获取文档 [1/1]: https://yapi.example.com/project/123</span></span>
<span class="line"><span>[2025-11-14 10:01:01] [MCP][INFO] URL 转换: https://yapi.example.com/project/123 -&gt; https://yapi.example.com/api/interface/get?id=123</span></span>
<span class="line"><span>[2025-11-14 10:01:01] [MCP][INFO] 使用缓存的 Session（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:01:02] [MCP][INFO] 获取数据成功，状态码: 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[2025-11-14 10:30:00] [MCP][WARNING] Session 已失效，重新登录（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:30:01] [MCP][INFO] 登录成功（用户: user@example.com）</span></span>
<span class="line"><span>[2025-11-14 10:30:01] [MCP][INFO] Session 已缓存（用户: user@example.com）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[2025-11-14 11:00:00] [MCP][INFO] === 连接断开 === 路径: /mcp/sse, session_id: abc123</span></span>
<span class="line"><span>[2025-11-14 11:00:00] [MCP][INFO] 清理会话映射: abc123 (用户: user@example.com)</span></span>
<span class="line"><span>[2025-11-14 11:00:00] [MCP][INFO] 当前活跃会话数: 0</span></span></code></pre></div><p><strong>日志分析价值：</strong></p><p>通过日志可以：</p><ol><li><strong>性能分析</strong>：统计接口响应时间、Session 缓存命中率</li><li><strong>用户行为</strong>：了解哪些接口被频繁查询</li><li><strong>问题定位</strong>：异常时查看完整的请求链路</li><li><strong>容量规划</strong>：分析并发用户数、请求峰值</li></ol><p><strong>日志最佳实践：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 不好的日志：信息不足</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logger.info(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;登录成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 好的日志：包含关键上下文</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logger.info(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;登录成功（用户: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">username</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">）&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 不好的日志：敏感信息暴露</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logger.info(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;登录：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">username</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">password</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 好的日志：脱敏处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logger.info(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;登录：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">username</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, 密码: ***&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_6-2-健康检查" tabindex="-1">6.2 健康检查 <a class="header-anchor" href="#_6-2-健康检查" aria-label="Permalink to &quot;6.2 健康检查&quot;">​</a></h3><p>Docker Compose 配置了自动健康检查，确保服务异常时能自动恢复。</p><div class="mermaid"></div><p><strong>健康检查机制详解：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CMD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;curl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-f&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:8000/mcp/health&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 检查间隔</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 超时时间</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 失败重试次数</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">40s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 启动宽限期</span></span></code></pre></div><p><strong>健康检查端点实现：</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.api_route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/mcp/health&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">methods</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> health_check</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;healthy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SERVER_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SERVER_VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;protocol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sse&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><p><strong>工作流程：</strong></p><ol><li><strong>启动阶段</strong>：容器启动后 40 秒内不进行健康检查（start_period），等待服务初始化完成</li><li><strong>正常运行</strong>：每 30 秒检查一次，10 秒内必须响应</li><li><strong>异常检测</strong>：连续失败 3 次，标记为 unhealthy</li><li><strong>自动恢复</strong>：Docker 自动重启 unhealthy 的容器</li></ol><p><strong>健康检查的价值：</strong></p><ul><li>进程僵死 → 自动重启</li><li>依赖服务不可用 → 快速发现问题</li><li>配合监控系统 → 及时告警</li><li>支持负载均衡 → 摘除不健康实例</li></ul><h3 id="_6-3-性能指标" tabindex="-1">6.3 性能指标 <a class="header-anchor" href="#_6-3-性能指标" aria-label="Permalink to &quot;6.3 性能指标&quot;">​</a></h3><p>系统在实际运行中的性能表现：</p><p>待补充</p><p><strong>性能优化空间：</strong></p><p>如果未来需要进一步优化，可以考虑：</p><ul><li>使用 Redis 实现分布式 Session 缓存（支持多实例部署）</li><li>接口文档预加载和本地缓存（减少 YApi 请求）</li><li>启用 HTTP/2（提升传输效率）</li></ul><h2 id="七、故障排查" tabindex="-1">七、故障排查 <a class="header-anchor" href="#七、故障排查" aria-label="Permalink to &quot;七、故障排查&quot;">​</a></h2><p>遇到问题时的系统化排查流程：</p><div class="mermaid"></div><p><strong>常见问题及解决方案：</strong></p><h3 id="_7-1-连接失败-无法建立-sse-连接" tabindex="-1">7.1. 连接失败：无法建立 SSE 连接 <a class="header-anchor" href="#_7-1-连接失败-无法建立-sse-连接" aria-label="Permalink to &quot;7.1. 连接失败：无法建立 SSE 连接&quot;">​</a></h3><p><strong>排查步骤：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 检查容器是否运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 应该看到 api-docs-mcp-server 状态为 Up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 检查容器日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-docs-mcp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看是否有启动错误</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 测试容器内部</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9527/mcp/health</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 应该返回 {&quot;status&quot;: &quot;healthy&quot;, ...}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 测试 Nginx 代理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://your-domain.com/mcp/health</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果失败，检查 Nginx 配置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 检查 Nginx 状态和日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/nginx/error.log</span></span></code></pre></div><h3 id="_7-2-认证失败-401-或-403-错误" tabindex="-1">7.2. 认证失败：401 或 403 错误 <a class="header-anchor" href="#_7-2-认证失败-401-或-403-错误" aria-label="Permalink to &quot;7.2. 认证失败：401 或 403 错误&quot;">​</a></h3><p><strong>可能原因：</strong></p><ul><li>mcp.json 中用户名或密码错误</li><li>YApi 账号被锁定或禁用</li><li>YApi 登录接口地址错误</li></ul><p><strong>解决方案：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 验证用户名密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://yapi.your-domain.com/api/user/login</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;email&quot;: &quot;user@example.com&quot;, &quot;password&quot;: &quot;your-password&quot;}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 检查容器日志中的认证日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;登录&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 更新 mcp.json 配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.cursor/mcp.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改 username 和 password</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 重启 Cursor IDE 使配置生效</span></span></code></pre></div><h3 id="_7-3-查询失败-无法获取接口文档" tabindex="-1">7.3. 查询失败：无法获取接口文档 <a class="header-anchor" href="#_7-3-查询失败-无法获取接口文档" aria-label="Permalink to &quot;7.3. 查询失败：无法获取接口文档&quot;">​</a></h3><p><strong>可能原因：</strong></p><ul><li>URL 格式错误</li><li>接口 ID 不存在</li><li>没有访问权限</li></ul><p><strong>解决方案：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 验证 URL 格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 正确：https://yapi.com/project/interface/api/12345</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或：https://yapi.com/api/interface/get?id=12345</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 查看详细错误日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ERROR&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 测试接口是否存在</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在浏览器中访问 YApi 页面，确认接口可访问</span></span></code></pre></div><h3 id="_7-4-性能问题-响应缓慢" tabindex="-1">7.4. 性能问题：响应缓慢 <a class="header-anchor" href="#_7-4-性能问题-响应缓慢" aria-label="Permalink to &quot;7.4. 性能问题：响应缓慢&quot;">​</a></h3><p><strong>排查步骤：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 检查 Session 缓存命中率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;缓存&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;使用&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 检查网络延迟</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yapi.your-domain.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 检查容器资源使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-docs-mcp-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 查看并发请求数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;活跃会话数&quot;</span></span></code></pre></div><h2 id="八、总结" tabindex="-1">八、总结 <a class="header-anchor" href="#八、总结" aria-label="Permalink to &quot;八、总结&quot;">​</a></h2><h3 id="_8-1-项目价值与收益" tabindex="-1">8.1 项目价值与收益 <a class="header-anchor" href="#_8-1-项目价值与收益" aria-label="Permalink to &quot;8.1 项目价值与收益&quot;">​</a></h3><p>本项目解决了 AI 辅助开发中文档获取的核心问题，通过 MCP 协议实现内网文档的智能访问，带来显著的效率提升。</p><p><strong>量化收益对比：</strong></p><table><thead><tr><th>维度</th><th>传统方式</th><th>使用 MCP 服务</th><th>提升幅度</th></tr></thead><tbody><tr><td>AI 访问文档</td><td>无法访问内网</td><td>自动登录访问</td><td>0→1</td></tr><tr><td>查文档时间</td><td>2-3 分钟/次</td><td>0 秒（AI 自动查询）</td><td>∞</td></tr><tr><td>写代码时间</td><td>5-8 分钟/接口</td><td>10 秒/接口</td><td>30-48x</td></tr><tr><td>新人上手时间</td><td>1-2 周熟悉接口文档</td><td>立即可用</td><td>减少 90%</td></tr><tr><td>文档获取时效性</td><td>手动查询，可能查到旧文档</td><td>实时获取最新版本</td><td>按需获取</td></tr></tbody></table><p><strong>核心价值：</strong></p><ol><li><strong>突破内网限制</strong> - 作为 AI 与内网 YApi 的桥梁，解决 AI 无法访问内网的根本问题</li><li><strong>自动认证管理</strong> - Session 缓存机制，30 天免登录，性能提升 600 倍</li><li><strong>按需实时查询</strong> - 无需手动同步，确保 AI 始终基于最新文档生成代码</li><li><strong>高可用保障</strong> - 自动重试、健康检查、容器化部署，服务稳定可靠</li></ol><h2 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语&quot;">​</a></h2><p>本项目不仅是一个技术实现，更是对&quot;如何让 AI 更好地辅助开发&quot;的一次探索。通过 MCP 协议，我们为 AI 提供了获取外部知识的能力，让它能够按需查询最新、准确的信息生成代码。</p><p>期待与大家一起探索 AI 辅助开发的无限可能！</p></div></div></main><footer class="VPDocFooter" data-v-87deb3fa data-v-d0fee7e2><!--[--><!--]--><!----><nav class="prev-next" data-v-d0fee7e2><div class="pager" data-v-d0fee7e2><a class="VPLink link pager-link prev" href="/ai/6" data-v-d0fee7e2><!--[--><span class="desc" data-v-d0fee7e2>Previous page</span><span class="title" data-v-d0fee7e2>AI Agent 构建实战指南详解</span><!--]--></a></div><div class="pager" data-v-d0fee7e2><a class="VPLink link pager-link next" href="/ai/8" data-v-d0fee7e2><!--[--><span class="desc" data-v-d0fee7e2>Next page</span><span class="title" data-v-d0fee7e2>AI 对话的实现与难点解析</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!----><!--]--></div><!----><!--]--></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai_1.md\":\"DTLVpkD9\",\"ai_2.md\":\"CISq3HR1\",\"ai_4.md\":\"EAXj2VsW\",\"ai_5.md\":\"CQnTJpY2\",\"ai_6.md\":\"BJBxTJzL\",\"ai_7.md\":\"B15PXkWV\",\"ai_8.md\":\"D5v6UD94\",\"code_vue2_392.md\":\"CEtg1q_F\",\"code_vue2_393.md\":\"CCR7GL0n\",\"code_vue2_394.md\":\"CN5omCsC\",\"code_vue2_395.md\":\"DOXDapgV\",\"code_vue2_396.md\":\"DfJpYHYk\",\"code_vue2_397.md\":\"9g-xxix9\",\"code_vue2_398.md\":\"B1_-7Wzc\",\"code_vue2_399.md\":\"BXsQHo0C\",\"code_vue2_400.md\":\"BZk-CCCY\",\"code_vue2_401.md\":\"u0MYEzmY\",\"code_webpack4_373.md\":\"MPFCmBij\",\"code_webpack4_374.md\":\"Bw7mbGjL\",\"code_webpack4_375.md\":\"Dr8qAwsx\",\"code_webpack4_376.md\":\"CDB4_0uP\",\"code_webpack4_377.md\":\"CBnrCvwr\",\"code_webpack4_378.md\":\"PgPTyrFW\",\"code_webpack4_379.md\":\"C_3yBaBu\",\"code_webpack4_380.md\":\"BkLNNtlR\",\"code_webpack4_381.md\":\"D3JERRfS\",\"code_webpack4_382.md\":\"DmYCgyMh\",\"code_webpack4_383.md\":\"DQX6PzGq\",\"code_webpack4_384.md\":\"CS97XZ6W\",\"code_webpack4_385.md\":\"2aOU--NT\",\"exp_css_187.md\":\"Dy7nTLQN\",\"exp_css_188.md\":\"hOhZxKTG\",\"exp_css_203.md\":\"xmT7PgA6\",\"exp_css_204.md\":\"DhEsWr86\",\"exp_css_208.md\":\"DBhs2BPH\",\"exp_css_210.md\":\"C0zCDrey\",\"exp_javascript_105.md\":\"CSJZi6RE\",\"exp_misc_312.md\":\"DMcy_ofd\",\"exp_misc_346.md\":\"vWothESe\",\"exp_misc_348.md\":\"4RelheiM\",\"exp_misc_356.md\":\"BRogFOQn\",\"exp_misc_361.md\":\"ClCXCYp2\",\"exp_misc_390.md\":\"C7zDtUbJ\",\"exp_misc_391.md\":\"DfsmLnTQ\",\"exp_misc_404.md\":\"DP5_KpRi\",\"exp_misc_407.md\":\"CGRj0xt6\",\"exp_misc_408.md\":\"DymPlMCF\",\"exp_misc_410.md\":\"DRz1-w4k\",\"exp_misc_411.md\":\"DnkYkSDj\",\"exp_misc_413.md\":\"m0Yn4Jow\",\"exp_misc_414.md\":\"DEQm7GTw\",\"exp_misc_415.md\":\"ByfXc9oC\",\"exp_misc_417.md\":\"BU7raUlX\",\"index.md\":\"BiU3u7eG\",\"links_index.md\":\"NGo8ETSP\",\"micro_2.md\":\"6QZTWIsm\",\"micro_4.md\":\"M-RbSHGB\",\"micro_5.md\":\"BLjW16VR\",\"micro_6.md\":\"_xLflo1x\",\"micro_7.md\":\"B-SF7rI0\",\"micro_999.md\":\"Ts8hqxhs\",\"misc_240.md\":\"Bcp-uHJh\",\"misc_257.md\":\"DJisd5-H\",\"misc_325.md\":\"CNQRJpMX\",\"misc_351.md\":\"CU7dCG7Y\",\"misc_355.md\":\"Bv740dXs\",\"misc_371.md\":\"BY29vpfQ\",\"misc_386.md\":\"gGLPLt1l\",\"misc_388.md\":\"CdhjTOR1\",\"misc_389.md\":\"CeS-J5aL\",\"misc_406.md\":\"C3asX7YG\",\"misc_888.md\":\"CaLOUkVi\",\"code_webpack4_372.md\":\"DfoC7T4l\",\"exp_javascript_366.md\":\"hsJOWlMS\",\"exp_misc_347.md\":\"C-hJ4Os-\",\"exp_misc_358.md\":\"Bxf42XbS\",\"exp_misc_416.md\":\"Bv7nqBU7\",\"micro_3.md\":\"BUUGFeav\",\"misc_277.md\":\"wBf1oZWo\",\"misc_349.md\":\"DGiUamJ4\",\"ai_3.md\":\"q0WVyZT_\",\"exp_javascript_104.md\":\"DsufE_l-\",\"exp_css_209.md\":\"CUyWLxh1\",\"exp_misc_359.md\":\"Bcp41XCJ\",\"misc_237.md\":\"Dyf3t9sP\",\"misc_317.md\":\"CfAc-0zE\",\"exp_css_186.md\":\"CWu1ROqt\",\"micro_1.md\":\"BCvoO0p5\",\"exp_misc_403.md\":\"DAddCSD5\",\"exp_javascript_106.md\":\"RPROSUgH\",\"exp_misc_405.md\":\"DSe6g_w-\",\"exp_misc_336.md\":\"4PFokEjd\",\"exp_javascript_101.md\":\"E4DYkNxD\",\"exp_javascript_103.md\":\"Cc7AqwST\",\"exp_javascript_102.md\":\"By6dFWp_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"korey的前端笔记\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/base/avatar.jpg\",\"outline\":[2,6],\"outlineTitle\":\"本文大纲\",\"nav\":[{\"text\":\"AI\",\"link\":\"/ai/1\",\"activeMatch\":\"/ai\"},{\"text\":\"微前端\",\"link\":\"/micro/999\",\"activeMatch\":\"/micro\"},{\"text\":\"经验沉淀\",\"items\":[{\"text\":\"javascript\",\"link\":\"/exp/javascript/101\",\"activeMatch\":\"/exp/javascipt\"},{\"text\":\"css\",\"link\":\"/exp/css/186\",\"activeMatch\":\"/exp/css\"},{\"text\":\"misc\",\"link\":\"/exp/misc/336\",\"activeMatch\":\"/exp/misc\"}]},{\"text\":\"源码系列\",\"items\":[{\"text\":\"webpack 4\",\"link\":\"/code/webpack4/372\",\"activeMatch\":\"/code/webpack4\"},{\"text\":\"vue 2\",\"link\":\"/code/vue2/392\",\"activeMatch\":\"/code/vue2/\"}]},{\"text\":\"其他杂项\",\"link\":\"/misc/237\",\"activeMatch\":\"/misc\"},{\"text\":\"更多\",\"link\":\"/links/index\",\"activeMatch\":\"/links\"}],\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"sidebar\":{\"/ai/\":[{\"text\":\"AI\",\"items\":[{\"text\":\"AI 技术架构对比：RAG、Function Calling、MCP 与 AI Agent 深度解析\",\"link\":\"/ai/1\"},{\"text\":\"深入剖析 WebAPI 的作用以及 n8n 和 Dify 的核心区别与最佳应用场景\",\"link\":\"/ai/2\"},{\"text\":\"AI 在实际生产环境中的提效实践 - 详细总结\",\"link\":\"/ai/3\"},{\"text\":\"AI 编程工具全景分析：2025 年发展现状与趋势\",\"link\":\"/ai/4\"},{\"text\":\"前端自建 MCP 服务连接框架文档指南\",\"link\":\"/ai/5\"},{\"text\":\"AI Agent 构建实战指南详解\",\"link\":\"/ai/6\"},{\"text\":\"基于 MCP 的智能 API 文档查询服务开发实践\",\"link\":\"/ai/7\"},{\"text\":\"AI 对话的实现与难点解析\",\"link\":\"/ai/8\"}]}],\"/micro/\":[{\"text\":\"微前端\",\"items\":[{\"text\":\"Module Federation\",\"link\":\"/micro/1\"},{\"text\":\"方案对比\",\"link\":\"/micro/2\"},{\"text\":\"single-spa 流程解析及简单实现\",\"link\":\"/micro/3\"},{\"text\":\"Wujie 主流程源码深度解析\",\"link\":\"/micro/4\"},{\"text\":\"single-spa 与 qiankun\",\"link\":\"/micro/5\"},{\"text\":\"2024 前端工程化大纲\",\"link\":\"/micro/6\"},{\"text\":\"微前端方案对比\",\"link\":\"/micro/7\"},{\"text\":\"微前端架构详解\",\"link\":\"/micro/999\"}]}],\"/code/\":[{\"text\":\"webpack 4\",\"collapsed\":false,\"items\":[{\"text\":\"源码分析（一）：前言及总流程概览\",\"link\":\"/code/webpack4/372\"},{\"text\":\"源码分析（二）：配置初始化\",\"link\":\"/code/webpack4/373\"},{\"text\":\"源码分析（三）：编译前的准备\",\"link\":\"/code/webpack4/374\"},{\"text\":\"源码分析（四）：reslove 前的准备\",\"link\":\"/code/webpack4/375\"},{\"text\":\"源码分析（五）：reslove 流程\",\"link\":\"/code/webpack4/376\"},{\"text\":\"源码分析（六）：构建 module（上）\",\"link\":\"/code/webpack4/377\"},{\"text\":\"源码分析（七）：构建 module（下）\",\"link\":\"/code/webpack4/378\"},{\"text\":\"源码分析（八）：生成 chunk\",\"link\":\"/code/webpack4/379\"},{\"text\":\"源码分析（九）：优化 chunk\",\"link\":\"/code/webpack4/380\"},{\"text\":\"源码分析（十）：资源的构建\",\"link\":\"/code/webpack4/381\"},{\"text\":\"源码分析（十一）：文件的生成\",\"link\":\"/code/webpack4/382\"},{\"text\":\"源码分析（十二）：打包后文件解析\",\"link\":\"/code/webpack4/383\"},{\"text\":\"源码分析（十三）：watch\",\"link\":\"/code/webpack4/384\"},{\"text\":\"源码分析（十四）：webpack 优化\",\"link\":\"/code/webpack4/385\"}]},{\"text\":\"vue 2\",\"collapsed\":false,\"items\":[{\"text\":\"源码笔记（一）：前言及总流程概览\",\"link\":\"/code/vue2/392\"},{\"text\":\"源码笔记（二）：源码结构及调试介绍\",\"link\":\"/code/vue2/393\"},{\"text\":\"源码笔记（三）：beforeCreate 阶段\",\"link\":\"/code/vue2/394\"},{\"text\":\"源码笔记（四）：created 阶段\",\"link\":\"/code/vue2/395\"},{\"text\":\"源码笔记（五）：beforeMount 阶段\",\"link\":\"/code/vue2/396\"},{\"text\":\"源码笔记（六）：mount 阶段生成 vnode\",\"link\":\"/code/vue2/397\"},{\"text\":\"源码笔记（七）：mount 阶段生成 dom\",\"link\":\"/code/vue2/398\"},{\"text\":\"源码笔记（八）：update 阶段（上）\",\"link\":\"/code/vue2/399\"},{\"text\":\"源码笔记（九）：update 阶段（下）\",\"link\":\"/code/vue2/400\"},{\"text\":\"源码笔记（十）：destroyed 阶段\",\"link\":\"/code/vue2/401\"}]}],\"/exp/\":[{\"text\":\"方案沉淀\",\"collapsed\":false,\"items\":[{\"text\":\"腾讯企点营销云项目性能优化方案\",\"link\":\"/exp/javascript/101\"},{\"text\":\"从小程序子包脚手架到工程化\",\"link\":\"/exp/javascript/102\"},{\"text\":\"Webpack5+TypeScript: 腾讯优码 SASS 端深度优化实践\",\"link\":\"/exp/javascript/103\"},{\"text\":\"基于实践探寻 babel7 最佳配置方案\",\"link\":\"/exp/javascript/104\"},{\"text\":\"腾讯 NFT H5\",\"link\":\"/exp/javascript/105\"},{\"text\":\"润达医疗 AI electron & startup 重构实践\",\"link\":\"/exp/javascript/106\"},{\"text\":\"使用 proxy 实现一个简单完整的 MVVM 库\",\"link\":\"/exp/javascript/366\"}]},{\"text\":\"css\",\"collapsed\":false,\"items\":[{\"text\":\"现代 CSS\",\"link\":\"/exp/css/186\"},{\"text\":\"CSS 视觉格式化模型\",\"link\":\"/exp/css/187\"},{\"text\":\"CSS 属性值的计算过程\",\"link\":\"/exp/css/188\"},{\"text\":\"CSS Flex 布局\",\"link\":\"/exp/css/203\"},{\"text\":\"CSS Grid 布局\",\"link\":\"/exp/css/204\"},{\"text\":\"CSS 居中方案整理\",\"link\":\"/exp/css/208\"},{\"text\":\"CSS 实现同行不等高块状元素自适应内容动态保持高度一致\",\"link\":\"/exp/css/209\"},{\"text\":\"CSS 实现长宽比固定的元素\",\"link\":\"/exp/css/210\"}]},{\"text\":\"misc\",\"collapsed\":false,\"items\":[{\"text\":\"用 GitLab CI 进行持续集成\",\"link\":\"/exp/misc/312\"},{\"text\":\"从输入 URL 到页面加载的过程所涉及到的知识点\",\"link\":\"/exp/misc/336\"},{\"text\":\"flqin blog 搭建记录\",\"link\":\"/exp/misc/346\"},{\"text\":\"git 命令总结\",\"link\":\"/exp/misc/347\"},{\"text\":\"amd,umd,commonJs,ES6 模块的相关总结\",\"link\":\"/exp/misc/348\"},{\"text\":\"nginx 配置总结\",\"link\":\"/exp/misc/356\"},{\"text\":\"promise 实现\",\"link\":\"/exp/misc/358\"},{\"text\":\"事件循环(Event Loop)\",\"link\":\"/exp/misc/359\"},{\"text\":\"使用 typescript 下的项目架构最佳实践\",\"link\":\"/exp/misc/361\"},{\"text\":\"前端安全汇总（持续更新）\",\"link\":\"/exp/misc/390\"},{\"text\":\"10 种常见的前端跨域解决方案（转）\",\"link\":\"/exp/misc/391\"},{\"text\":\"前端页面性能监控基础\",\"link\":\"/exp/misc/403\"},{\"text\":\"鉴权方案总结\",\"link\":\"/exp/misc/404\"},{\"text\":\"排序算法小结\",\"link\":\"/exp/misc/405\"},{\"text\":\"微信、支付宝及第三方 H5 支付，各平台分享总结\",\"link\":\"/exp/misc/407\"},{\"text\":\"《Javascript 密码花园》 笔记\",\"link\":\"/exp/misc/408\"},{\"text\":\"前端性能优化大纲\",\"link\":\"/exp/misc/410\"},{\"text\":\"基于 electron 开发在线课堂\",\"link\":\"/exp/misc/411\"},{\"text\":\"lerna 笔记\",\"link\":\"/exp/misc/413\"},{\"text\":\"NPM 依赖管理复杂性深度分析\",\"link\":\"/exp/misc/414\"},{\"text\":\"NPM 依赖管理的系统性复杂度分析\",\"link\":\"/exp/misc/415\"},{\"text\":\"前端知识体系\",\"link\":\"/exp/misc/416\"},{\"text\":\"Kubernetes 实践笔记\",\"link\":\"/exp/misc/417\"}]}],\"/misc/\":[{\"text\":\"其他杂项\",\"items\":[{\"text\":\"JS 基础：类型识别\",\"link\":\"/misc/237\"},{\"text\":\"JS 基础：神奇的 this\",\"link\":\"/misc/240\"},{\"text\":\"JS 基础：数组去重\",\"link\":\"/misc/257\"},{\"text\":\"JS 基础：原型与原型链\",\"link\":\"/misc/277\"},{\"text\":\"JS 基础：闭包\",\"link\":\"/misc/317\"},{\"text\":\"JS 基础：防抖与节流\",\"link\":\"/misc/325\"},{\"text\":\"JS 基础：变量声明\",\"link\":\"/misc/349\"},{\"text\":\"JS 基础：遍历对象\",\"link\":\"/misc/351\"},{\"text\":\"JS 基础：深浅拷贝\",\"link\":\"/misc/355\"},{\"text\":\"JS 基础：proxy\",\"link\":\"/misc/371\"},{\"text\":\"JS 基础：数组方法实现\",\"link\":\"/misc/386\"},{\"text\":\"JS 基础：实现 Generator\",\"link\":\"/misc/388\"},{\"text\":\"JS 基础：柯里化与反柯里化\",\"link\":\"/misc/389\"},{\"text\":\"JS 基础：设计模式\",\"link\":\"/misc/406\"},{\"text\":\"HTTP 状态码\",\"link\":\"/misc/888\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zhaoky\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>
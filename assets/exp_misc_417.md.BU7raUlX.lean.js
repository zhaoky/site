import{_ as E,C as r,c as d,o as n,R as k,b as h,k as e,w as i,a,G as p,a1 as t}from"./chunks/framework.Dxoqk0BT.js";const D=JSON.parse('{"title":"Kubernetes 实践笔记","description":"","frontmatter":{},"headers":[],"relativePath":"exp/misc/417.md","filePath":"exp/misc/417.md"}'),g={name:"exp/misc/417.md"};function o(y,s,F,c,A,B){const l=r("Mermaid");return n(),d("div",null,[s[31]||(s[31]=k(`<h1 id="kubernetes-实践笔记" tabindex="-1">Kubernetes 实践笔记 <a class="header-anchor" href="#kubernetes-实践笔记" aria-label="Permalink to &quot;Kubernetes 实践笔记&quot;">​</a></h1><h2 id="_1-准备工作" tabindex="-1">1. 准备工作 <a class="header-anchor" href="#_1-准备工作" aria-label="Permalink to &quot;1. 准备工作&quot;">​</a></h2><p>在开始 Kubernetes 学习之前，需要配置好本地环境。以下是必需的工具和安装步骤。</p><h3 id="_1-1-安装-docker" tabindex="-1">1.1 安装 Docker <a class="header-anchor" href="#_1-1-安装-docker" aria-label="Permalink to &quot;1.1 安装 Docker&quot;">​</a></h3><p>Docker 是容器化技术的基础，用于构建和运行容器镜像。</p><h4 id="推荐安装方法" tabindex="-1">推荐安装方法 <a class="header-anchor" href="#推荐安装方法" aria-label="Permalink to &quot;推荐安装方法&quot;">​</a></h4><p>使用 Docker Desktop 是最简单的安装方案：</p><ol><li>访问 <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noreferrer">Docker Desktop 官网</a></li><li>下载对应操作系统的安装包</li><li>按照安装向导完成安装</li></ol><p><strong>验证安装：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hello-world</span></span></code></pre></div><h4 id="替代安装方法" tabindex="-1">替代安装方法 <a class="header-anchor" href="#替代安装方法" aria-label="Permalink to &quot;替代安装方法&quot;">​</a></h4><p>由于 Docker Desktop 对大型企业收费（2021 年起），可以选择只安装 Docker CLI。</p><h3 id="_1-2-安装-minikube" tabindex="-1">1.2 安装 Minikube <a class="header-anchor" href="#_1-2-安装-minikube" aria-label="Permalink to &quot;1.2 安装 Minikube&quot;">​</a></h3><p>Minikube 用于在本地搭建 Kubernetes 集群，是学习 K8s 的理想选择。</p><p><strong>MacOS 安装：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minikube</span></span></code></pre></div><p><strong>启动 Minikube：</strong></p><p>如果使用 Docker Desktop：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-driver</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --container-runtime=docker</span></span></code></pre></div><p>如果只有 Docker CLI：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hyperkit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --vm-driver</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hyperkit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --container-runtime=docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置 Docker CLI 连接到 minikube</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-env)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加主机名映射</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip\` docker.local&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hello-world</span></span></code></pre></div><p><strong>验证安装：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div><h4 id="minikube-常用命令" tabindex="-1">Minikube 常用命令 <a class="header-anchor" href="#minikube-常用命令" aria-label="Permalink to &quot;Minikube 常用命令&quot;">​</a></h4>`,24)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-76",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BMinikube%20%E5%91%BD%E4%BB%A4%5D%20--%3E%20B%5Bminikube%20start%5D%0A%20%20%20%20A%20--%3E%20C%5Bminikube%20stop%5D%0A%20%20%20%20A%20--%3E%20D%5Bminikube%20delete%5D%0A%20%20%20%20A%20--%3E%20E%5Bminikube%20status%5D%0A%20%20%20%20A%20--%3E%20F%5Bminikube%20ip%5D%0A%20%20%20%20A%20--%3E%20G%5Bminikube%20pause%5D%0A%0A%20%20%20%20B%20--%3E%20B1%5B%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4%3Cbr%2F%3E%E4%B8%8D%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%5D%0A%20%20%20%20C%20--%3E%20C1%5B%E5%81%9C%E6%AD%A2%E9%9B%86%E7%BE%A4%3Cbr%2F%3E%E4%BF%9D%E7%95%99%E6%95%B0%E6%8D%AE%5D%0A%20%20%20%20D%20--%3E%20D1%5B%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%3Cbr%2F%3E%E5%AE%8C%E5%85%A8%E6%B8%85%E7%90%86%5D%0A%20%20%20%20E%20--%3E%20E1%5B%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81%5D%0A%20%20%20%20F%20--%3E%20F1%5B%E8%8E%B7%E5%8F%96%E9%9B%86%E7%BE%A4IP%E5%9C%B0%E5%9D%80%5D%0A%20%20%20%20G%20--%3E%20G1%5B%E6%9A%82%E5%81%9C%E8%B5%84%E6%BA%90%E5%92%8C%E9%9B%86%E7%BE%A4%5D%0A"})]),fallback:i(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[32]||(s[32]=k('<table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td><code>minikube start</code></td><td>启动 Kubernetes 集群</td></tr><tr><td><code>minikube stop</code></td><td>停止集群（保留数据）</td></tr><tr><td><code>minikube delete</code></td><td>删除所有集群数据</td></tr><tr><td><code>minikube status</code></td><td>查看集群状态</td></tr><tr><td><code>minikube ip</code></td><td>获取集群 IP 地址</td></tr><tr><td><code>minikube pause</code></td><td>暂停集群资源</td></tr></tbody></table><h3 id="_1-3-安装-kubectl" tabindex="-1">1.3 安装 kubectl <a class="header-anchor" href="#_1-3-安装-kubectl" aria-label="Permalink to &quot;1.3 安装 kubectl&quot;">​</a></h3><p>kubectl 是 Kubernetes 的命令行工具，用于与集群交互。</p><p><strong>MacOS 安装：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span></span></code></pre></div><blockquote><p><strong>注意：</strong> 如果不安装 kubectl，可以使用 <code>minikube kubectl</code> 命令替代所有 <code>kubectl</code> 操作。</p></blockquote><h3 id="_1-4-注册-docker-hub-账号" tabindex="-1">1.4 注册 Docker Hub 账号 <a class="header-anchor" href="#_1-4-注册-docker-hub-账号" aria-label="Permalink to &quot;1.4 注册 Docker Hub 账号&quot;">​</a></h3><p>由于 Minikube 默认从 DockerHub 拉取镜像，需要：</p><ol><li>在 <a href="https://hub.docker.com/" target="_blank" rel="noreferrer">Docker Hub</a> 注册账号</li><li>使用命令行登录：</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span></span></code></pre></div><h3 id="环境架构图" tabindex="-1">环境架构图 <a class="header-anchor" href="#环境架构图" aria-label="Permalink to &quot;环境架构图&quot;">​</a></h3>',11)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-176",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%22%0A%20%20%20%20%20%20%20%20A%5BDocker%20Desktop%2FCLI%5D%20--%3E%20B%5B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%5D%0A%20%20%20%20%20%20%20%20C%5BMinikube%5D%20--%3E%20D%5B%E6%9C%AC%E5%9C%B0%20K8s%20%E9%9B%86%E7%BE%A4%5D%0A%20%20%20%20%20%20%20%20E%5Bkubectl%5D%20--%3E%20D%0A%20%20%20%20%20%20%20%20F%5BDocker%20Hub%5D%20--%3E%20B%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%22%0A%20%20%20%20%20%20%20%20G%5B%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%5D%20--%3E%20H%5B%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%5D%0A%20%20%20%20%20%20%20%20H%20--%3E%20I%5B%E6%8E%A8%E9%80%81%E5%88%B0%20Docker%20Hub%5D%0A%20%20%20%20%20%20%20%20I%20--%3E%20J%5B%E9%83%A8%E7%BD%B2%E5%88%B0%20K8s%20%E9%9B%86%E7%BE%A4%5D%0A%20%20%20%20end%0A%0A%20%20%20%20B%20--%3E%20D%0A%20%20%20%20D%20--%3E%20J%0A"})]),fallback:i(()=>[...s[1]||(s[1]=[a(" Loading... ",-1)])]),_:1})),s[33]||(s[33]=k(`<h3 id="准备工作检查清单" tabindex="-1">准备工作检查清单 <a class="header-anchor" href="#准备工作检查清单" aria-label="Permalink to &quot;准备工作检查清单&quot;">​</a></h3><ul><li>[ ] Docker 安装并能运行 <code>hello-world</code></li><li>[ ] Minikube 安装并成功启动</li><li>[ ] kubectl 安装（或使用 <code>minikube kubectl</code>）</li><li>[ ] Docker Hub 账号注册并登录</li><li>[ ] <code>minikube status</code> 显示集群运行正常</li></ul><p>完成以上准备工作后，就可以开始 Kubernetes 的实践学习了。</p><h2 id="_2-container-容器化" tabindex="-1">2. Container（容器化） <a class="header-anchor" href="#_2-container-容器化" aria-label="Permalink to &quot;2. Container（容器化）&quot;">​</a></h2><p>容器化是 Kubernetes 的基础。我们从一个简单的 Go 应用开始，学习如何将代码打包成容器镜像。</p><h3 id="_2-1-示例应用" tabindex="-1">2.1 示例应用 <a class="header-anchor" href="#_2-1-示例应用" aria-label="Permalink to &quot;2.1 示例应用&quot;">​</a></h3><p>创建一个简单的 Go Web 服务：</p><h4 id="main-go" tabindex="-1">main.go <a class="header-anchor" href="#main-go" aria-label="Permalink to &quot;main.go&quot;">​</a></h4><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v1] Hello, Kubernetes!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这个应用：</p><ul><li>启动 HTTP 服务器，监听 3000 端口</li><li>访问根路径 <code>/</code> 时返回 <code>[v1] Hello, Kubernetes!</code></li></ul><h3 id="_2-2-容器化的优势" tabindex="-1">2.2 容器化的优势 <a class="header-anchor" href="#_2-2-容器化的优势" aria-label="Permalink to &quot;2.2 容器化的优势&quot;">​</a></h3>`,12)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-244",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20subgraph%20%22%E4%BC%A0%E7%BB%9F%E9%83%A8%E7%BD%B2%22%0A%20%20%20%20%20%20%20%20A1%5B%E5%AE%89%E8%A3%85%20Go%20%E7%8E%AF%E5%A2%83%5D%20--%3E%20A2%5B%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%5D%0A%20%20%20%20%20%20%20%20A2%20--%3E%20A3%5B%E5%A4%84%E7%90%86%E4%BE%9D%E8%B5%96%5D%0A%20%20%20%20%20%20%20%20A3%20--%3E%20A4%5B%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%5D%0A%20%20%20%20%20%20%20%20A4%20--%3E%20A5%5B%E5%8F%AF%E8%83%BD%E7%9A%84%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2%22%0A%20%20%20%20%20%20%20%20B1%5B%E7%BC%96%E5%86%99%20Dockerfile%5D%20--%3E%20B2%5B%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20B3%5B%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%5D%0A%20%20%20%20%20%20%20%20B3%20--%3E%20B4%5B%E4%B8%80%E8%87%B4%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[2]||(s[2]=[a(" Loading... ",-1)])]),_:1})),s[34]||(s[34]=k(`<p><strong>容器化的好处：</strong></p><ul><li><strong>环境一致性</strong>：消除&quot;在我机器上能运行&quot;的问题</li><li><strong>快速部署</strong>：无需安装运行时环境</li><li><strong>资源隔离</strong>：沙盒技术保证安全性</li><li><strong>易于分发</strong>：镜像可以轻松共享</li></ul><h3 id="_2-3-编写-dockerfile" tabindex="-1">2.3 编写 Dockerfile <a class="header-anchor" href="#_2-3-编写-dockerfile" aria-label="Permalink to &quot;2.3 编写 Dockerfile&quot;">​</a></h3><h4 id="dockerfile" tabindex="-1">Dockerfile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;Dockerfile&quot;">​</a></h4><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 多阶段构建：先编译，再打包</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> golang:1.16-buster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mkdir /src</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . /src</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /src</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> go env -w GO111MODULE=auto</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> go build -o main .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用精简的基础镜像</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gcr.io/distroless/base-debian10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /src/main /main</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><strong>多阶段构建的优势：</strong></p><ul><li>将 300MB 的镜像压缩到 20MB</li><li>上传到 Docker Hub 后仅 10MB</li><li>提高网络传输效率</li></ul><h3 id="_2-4-构建和运行" tabindex="-1">2.4 构建和运行 <a class="header-anchor" href="#_2-4-构建和运行" aria-label="Permalink to &quot;2.4 构建和运行&quot;">​</a></h3><p><strong>构建镜像：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 替换 guangzhengli 为你的 Docker Hub 用户名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v1</span></span></code></pre></div><p><strong>查看镜像：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># guangzhengli/hellok8s    v1    f956e8cf7d18    8 days ago    25.4MB</span></span></code></pre></div><p><strong>运行容器：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v1</span></span></code></pre></div><p><strong>测试应用：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果使用 minikube，需要使用 minikube IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 例如返回 192.168.59.100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://192.168.59.100:3000</span></span></code></pre></div><p><strong>推送到 Docker Hub：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v1</span></span></code></pre></div><h3 id="_2-5-容器技术原理" tabindex="-1">2.5 容器技术原理 <a class="header-anchor" href="#_2-5-容器技术原理" aria-label="Permalink to &quot;2.5 容器技术原理&quot;">​</a></h3>`,19)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-323",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%22%0A%20%20%20%20%20%20%20%20A%5BLinux%20Namespace%5D%20--%3E%20D%5B%E5%AE%B9%E5%99%A8%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20%20%20%20%20B%5BCgroups%5D%20--%3E%20D%0A%20%20%20%20%20%20%20%20C%5Bchroot%5D%20--%3E%20D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E5%AE%B9%E5%99%A8%20vs%20%E8%99%9A%E6%8B%9F%E6%9C%BA%22%0A%20%20%20%20%20%20%20%20E%5B%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%5D%20--%3E%20F%5B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%5D%0A%20%20%20%20%20%20%20%20F%20--%3E%20G%5B%E5%AE%B9%E5%99%A81%5D%0A%20%20%20%20%20%20%20%20F%20--%3E%20H%5B%E5%AE%B9%E5%99%A82%5D%0A%20%20%20%20%20%20%20%20F%20--%3E%20I%5B%E5%AE%B9%E5%99%A83%5D%0A%0A%20%20%20%20%20%20%20%20J%5B%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%5D%20--%3E%20K%5B%E8%99%9A%E6%8B%9F%E5%8C%96%E5%B1%82%5D%0A%20%20%20%20%20%20%20%20K%20--%3E%20L%5B%E8%99%9A%E6%8B%9F%E6%9C%BA1%3Cbr%2F%3E%E5%AE%8C%E6%95%B4OS%5D%0A%20%20%20%20%20%20%20%20K%20--%3E%20M%5B%E8%99%9A%E6%8B%9F%E6%9C%BA2%3Cbr%2F%3E%E5%AE%8C%E6%95%B4OS%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[3]||(s[3]=[a(" Loading... ",-1)])]),_:1})),s[35]||(s[35]=e("p",null,[e("strong",null,"容器是什么？")],-1)),s[36]||(s[36]=e("ul",null,[e("li",null,"基于 Linux Namespace、Cgroups、chroot 等技术"),e("li",null,"提供进程级别的隔离"),e("li",null,"共享宿主机内核，比虚拟机更轻量")],-1)),s[37]||(s[37]=e("h3",{id:"_2-6-容器化流程图",tabindex:"-1"},[a("2.6 容器化流程图 "),e("a",{class:"header-anchor",href:"#_2-6-容器化流程图","aria-label":'Permalink to "2.6 容器化流程图"'},"​")],-1)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-347",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E4%BB%A3%E7%A0%81%5D%20--%3E%20B%5B%E5%88%9B%E5%BB%BA%20Dockerfile%5D%0A%20%20%20%20B%20--%3E%20C%5B%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%3Cbr%2F%3Edocker%20build%5D%0A%20%20%20%20C%20--%3E%20D%5B%E6%B5%8B%E8%AF%95%E9%95%9C%E5%83%8F%3Cbr%2F%3Edocker%20run%5D%0A%20%20%20%20D%20--%3E%20E%7B%E6%B5%8B%E8%AF%95%E9%80%9A%E8%BF%87%3F%7D%0A%20%20%20%20E%20--%3E%7C%E5%90%A6%7C%20B%0A%20%20%20%20E%20--%3E%7C%E6%98%AF%7C%20F%5B%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F%3Cbr%2F%3Edocker%20push%5D%0A%20%20%20%20F%20--%3E%20G%5B%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%3Cbr%2F%3EDocker%20Hub%5D%0A%20%20%20%20G%20--%3E%20H%5B%E5%85%B6%E4%BB%96%E7%8E%AF%E5%A2%83%E6%8B%89%E5%8F%96%3Cbr%2F%3Edocker%20pull%5D%0A%20%20%20%20H%20--%3E%20I%5B%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C%3Cbr%2F%3Edocker%20run%5D%0A"})]),fallback:i(()=>[...s[4]||(s[4]=[a(" Loading... ",-1)])]),_:1})),s[38]||(s[38]=k(`<h3 id="_2-7-实践练习" tabindex="-1">2.7 实践练习 <a class="header-anchor" href="#_2-7-实践练习" aria-label="Permalink to &quot;2.7 实践练习&quot;">​</a></h3><p>尝试容器化其他服务：</p><ol><li><p><strong>Nginx 服务</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8080</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div></li><li><p><strong>MySQL 数据库</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql:8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MYSQL_ROOT_PASSWORD=password</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3306</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3306</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql:8.0</span></span></code></pre></div></li><li><p><strong>Redis 缓存</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:6379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span></span></code></pre></div></li></ol><h3 id="小结-容器化" tabindex="-1">小结：容器化 <a class="header-anchor" href="#小结-容器化" aria-label="Permalink to &quot;小结：容器化&quot;">​</a></h3><p>通过这个章节，我们学会了：</p><ul><li>✅ 编写简单的 Go Web 应用</li><li>✅ 创建 Dockerfile 进行容器化</li><li>✅ 使用多阶段构建优化镜像大小</li><li>✅ 构建、运行和推送 Docker 镜像</li><li>✅ 理解容器技术的基本原理</li></ul><p>容器化解决了应用部署的环境一致性问题，为后续的 Kubernetes 学习奠定了基础。</p><h2 id="_3-pod-最小部署单元" tabindex="-1">3. Pod（最小部署单元） <a class="header-anchor" href="#_3-pod-最小部署单元" aria-label="Permalink to &quot;3. Pod（最小部署单元）&quot;">​</a></h2><p>Pod 是 Kubernetes 中可以创建和管理的最小可部署计算单元。理解 Pod 是掌握 Kubernetes 的关键第一步。</p><h3 id="_3-1-什么是-pod" tabindex="-1">3.1 什么是 Pod <a class="header-anchor" href="#_3-1-什么是-pod" aria-label="Permalink to &quot;3.1 什么是 Pod&quot;">​</a></h3>`,10)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-419",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Pod%20%E6%A6%82%E5%BF%B5%22%0A%20%20%20%20%20%20%20%20A%5BPod%5D%20--%3E%20B%5BContainer%201%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%20C%5BContainer%202%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%20D%5B%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%20E%5B%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Pod%20vs%20Container%22%0A%20%20%20%20%20%20%20%20F%5B%E5%8D%95%E4%B8%AA%20Container%5D%20--%3E%20F1%5B%E7%8B%AC%E7%AB%8B%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20%20%20%20%20G%5BPod%5D%20--%3E%20G1%5B%E7%AE%A1%E7%90%86%E4%B8%80%E7%BB%84%E8%BF%9B%E7%A8%8B%5D%0A%20%20%20%20%20%20%20%20G1%20--%3E%20G2%5B%E5%85%B1%E4%BA%AB%20localhost%5D%0A%20%20%20%20%20%20%20%20G1%20--%3E%20G3%5B%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[5]||(s[5]=[a(" Loading... ",-1)])]),_:1})),s[39]||(s[39]=k(`<p><strong>Pod 的特点：</strong></p><ul><li>包含一个或多个容器</li><li>容器共享网络和存储</li><li>Pod 内容器可以通过 <code>localhost</code> 通信</li><li>Pod 是原子性的部署单位</li></ul><h3 id="_3-2-创建第一个-pod" tabindex="-1">3.2 创建第一个 Pod <a class="header-anchor" href="#_3-2-创建第一个-pod" aria-label="Permalink to &quot;3.2 创建第一个 Pod&quot;">​</a></h3><p>让我们从一个简单的 Nginx Pod 开始：</p><h4 id="nginx-yaml" tabindex="-1">nginx.yaml <a class="header-anchor" href="#nginx-yaml" aria-label="Permalink to &quot;nginx.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx-pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span></code></pre></div><p><strong>YAML 文件解析：</strong></p><ul><li><code>apiVersion: v1</code> - API 版本</li><li><code>kind: Pod</code> - 资源类型</li><li><code>metadata.name</code> - Pod 名称（集群内唯一）</li><li><code>spec.containers</code> - 容器定义列表</li></ul><h3 id="_3-3-pod-操作实践" tabindex="-1">3.3 Pod 操作实践 <a class="header-anchor" href="#_3-3-pod-操作实践" aria-label="Permalink to &quot;3.3 Pod 操作实践&quot;">​</a></h3><p><strong>创建 Pod：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx.yaml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pod/nginx-pod created</span></span></code></pre></div><p><strong>查看 Pod 状态：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME        READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nginx-pod   1/1     Running   0          6s</span></span></code></pre></div><p><strong>端口转发访问：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:80</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Forwarding from 127.0.0.1:4000 -&gt; 80</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Forwarding from [::1]:4000 -&gt; 80</span></span></code></pre></div><p><strong>测试访问：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:4000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 返回 Nginx 默认页面</span></span></code></pre></div><h3 id="_3-4-进入-pod-容器" tabindex="-1">3.4 进入 Pod 容器 <a class="header-anchor" href="#_3-4-进入-pod-容器" aria-label="Permalink to &quot;3.4 进入 Pod 容器&quot;">​</a></h3><p><strong>执行命令：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/bash</span></span></code></pre></div><p><strong>修改 Nginx 首页：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hello kubernetes by nginx!&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/nginx/html/index.html</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span></code></pre></div><p><strong>再次测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:4000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hello kubernetes by nginx!</span></span></code></pre></div><h3 id="_3-5-pod-生命周期" tabindex="-1">3.5 Pod 生命周期 <a class="header-anchor" href="#_3-5-pod-生命周期" aria-label="Permalink to &quot;3.5 Pod 生命周期&quot;">​</a></h3>`,25)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-517",class:"mermaid",graph:"stateDiagram-v2%0A%20%20%20%20%5B*%5D%20--%3E%20Pending%3A%20%E5%88%9B%E5%BB%BA%20Pod%0A%20%20%20%20Pending%20--%3E%20Running%3A%20%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F%0A%20%20%20%20Running%20--%3E%20Succeeded%3A%20%E5%AE%B9%E5%99%A8%E6%AD%A3%E5%B8%B8%E9%80%80%E5%87%BA%0A%20%20%20%20Running%20--%3E%20Failed%3A%20%E5%AE%B9%E5%99%A8%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%0A%20%20%20%20Running%20--%3E%20Unknown%3A%20%E8%8A%82%E7%82%B9%E9%80%9A%E4%BF%A1%E5%A4%B1%E8%B4%A5%0A%20%20%20%20Succeeded%20--%3E%20%5B*%5D%0A%20%20%20%20Failed%20--%3E%20%5B*%5D%0A%20%20%20%20Unknown%20--%3E%20Running%3A%20%E6%81%A2%E5%A4%8D%E9%80%9A%E4%BF%A1%0A%20%20%20%20Unknown%20--%3E%20Failed%3A%20%E7%A1%AE%E8%AE%A4%E5%A4%B1%E8%B4%A5%0A"})]),fallback:i(()=>[...s[6]||(s[6]=[a(" Loading... ",-1)])]),_:1})),s[40]||(s[40]=k('<p><strong>Pod 状态说明：</strong></p><ul><li><strong>Pending</strong>: Pod 已创建，但容器未启动</li><li><strong>Running</strong>: Pod 已绑定到节点，所有容器已创建</li><li><strong>Succeeded</strong>: 所有容器成功终止</li><li><strong>Failed</strong>: 至少一个容器失败终止</li><li><strong>Unknown</strong>: 无法获取 Pod 状态</li></ul><h3 id="_3-6-pod-与-container-的关系" tabindex="-1">3.6 Pod 与 Container 的关系 <a class="header-anchor" href="#_3-6-pod-与-container-的关系" aria-label="Permalink to &quot;3.6 Pod 与 Container 的关系&quot;">​</a></h3>',3)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-551",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Kubernetes%20%E9%9B%86%E7%BE%A4%22%0A%20%20%20%20%20%20%20%20subgraph%20%22Node%201%22%0A%20%20%20%20%20%20%20%20%20%20%20%20subgraph%20%22Pod%20A%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A1%5BNginx%20Container%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A2%5BSidecar%20Container%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A3%5B%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C%20localhost%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20A4%5B%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E5%8D%B7%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20subgraph%20%22Pod%20B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20B1%5BApp%20Container%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22Node%202%22%0A%20%20%20%20%20%20%20%20%20%20%20%20subgraph%20%22Pod%20C%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C1%5BDatabase%20Container%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[7]||(s[7]=[a(" Loading... ",-1)])]),_:1})),s[41]||(s[41]=k(`<p><strong>使用场景：</strong></p><ol><li><strong>单容器 Pod</strong>（最常见） <ul><li>一个 Pod 包含一个应用容器</li></ul></li><li><strong>多容器 Pod</strong>（特殊场景） <ul><li>日志收集：主应用 + 日志收集器</li><li>代理服务：主应用 + 网络代理</li><li>数据同步：主应用 + 数据同步器</li></ul></li></ol><h3 id="_3-7-创建-hellok8s-pod" tabindex="-1">3.7 创建 HelloK8s Pod <a class="header-anchor" href="#_3-7-创建-hellok8s-pod" aria-label="Permalink to &quot;3.7 创建 HelloK8s Pod&quot;">​</a></h3><p>基于之前构建的镜像创建 Pod：</p><h4 id="hellok8s-yaml" tabindex="-1">hellok8s.yaml <a class="header-anchor" href="#hellok8s-yaml" aria-label="Permalink to &quot;hellok8s.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v1</span></span></code></pre></div><p><strong>部署和测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新终端测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v1] Hello, Kubernetes!</span></span></code></pre></div><h3 id="_3-8-pod-常用命令" tabindex="-1">3.8 Pod 常用命令 <a class="header-anchor" href="#_3-8-pod-常用命令" aria-label="Permalink to &quot;3.8 Pod 常用命令&quot;">​</a></h3>`,9)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-608",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BPod%20%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%5D%20--%3E%20B%5Bkubectl%20apply%20-f%20pod.yaml%5D%0A%20%20%20%20A%20--%3E%20C%5Bkubectl%20get%20pods%5D%0A%20%20%20%20A%20--%3E%20D%5Bkubectl%20describe%20pod%5D%0A%20%20%20%20A%20--%3E%20E%5Bkubectl%20logs%20pod-name%5D%0A%20%20%20%20A%20--%3E%20F%5Bkubectl%20exec%20-it%20pod-name%5D%0A%20%20%20%20A%20--%3E%20G%5Bkubectl%20delete%20pod%5D%0A%0A%20%20%20%20B%20--%3E%20B1%5B%E5%88%9B%E5%BB%BA%2F%E6%9B%B4%E6%96%B0%20Pod%5D%0A%20%20%20%20C%20--%3E%20C1%5B%E6%9F%A5%E7%9C%8B%20Pod%20%E5%88%97%E8%A1%A8%5D%0A%20%20%20%20D%20--%3E%20D1%5B%E6%9F%A5%E7%9C%8B%20Pod%20%E8%AF%A6%E6%83%85%5D%0A%20%20%20%20E%20--%3E%20E1%5B%E6%9F%A5%E7%9C%8B%20Pod%20%E6%97%A5%E5%BF%97%5D%0A%20%20%20%20F%20--%3E%20F1%5B%E8%BF%9B%E5%85%A5%20Pod%20%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%5D%0A%20%20%20%20G%20--%3E%20G1%5B%E5%88%A0%E9%99%A4%20Pod%5D%0A"})]),fallback:i(()=>[...s[8]||(s[8]=[a(" Loading... ",-1)])]),_:1})),s[42]||(s[42]=k(`<p><strong>常用命令汇总：</strong></p><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td><code>kubectl apply -f pod.yaml</code></td><td>创建或更新 Pod</td></tr><tr><td><code>kubectl get pods</code></td><td>查看 Pod 列表</td></tr><tr><td><code>kubectl get pods -o wide</code></td><td>查看 Pod 详细信息</td></tr><tr><td><code>kubectl describe pod &lt;name&gt;</code></td><td>查看 Pod 详情和事件</td></tr><tr><td><code>kubectl logs &lt;pod-name&gt;</code></td><td>查看 Pod 日志</td></tr><tr><td><code>kubectl logs -f &lt;pod-name&gt;</code></td><td>实时查看日志</td></tr><tr><td><code>kubectl exec -it &lt;pod&gt; -- /bin/bash</code></td><td>进入 Pod 执行命令</td></tr><tr><td><code>kubectl port-forward &lt;pod&gt; 8080:80</code></td><td>端口转发</td></tr><tr><td><code>kubectl delete pod &lt;name&gt;</code></td><td>删除 Pod</td></tr><tr><td><code>kubectl delete -f pod.yaml</code></td><td>通过文件删除 Pod</td></tr></tbody></table><h3 id="_3-9-故障排查" tabindex="-1">3.9 故障排查 <a class="header-anchor" href="#_3-9-故障排查" aria-label="Permalink to &quot;3.9 故障排查&quot;">​</a></h3><p><strong>Pod 启动失败排查：</strong></p><ol><li><p><strong>查看 Pod 状态：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s   0/1     ImagePullBackOff   0          22m</span></span></code></pre></div></li><li><p><strong>查看详细信息：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span></span></code></pre></div></li><li><p><strong>常见问题和解决方案：</strong></p><ul><li><p><code>ImagePullBackOff</code>: 镜像拉取失败</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换到 minikube docker 环境</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-env)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重新构建镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v1</span></span></code></pre></div></li><li><p><code>CrashLoopBackOff</code>: 容器启动后立即退出</p></li><li><p><code>Pending</code>: 资源不足或调度失败</p></li></ul></li></ol><h3 id="_3-10-pod-网络模型" tabindex="-1">3.10 Pod 网络模型 <a class="header-anchor" href="#_3-10-pod-网络模型" aria-label="Permalink to &quot;3.10 Pod 网络模型&quot;">​</a></h3>`,6)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-752",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Pod%20%E7%BD%91%E7%BB%9C%22%0A%20%20%20%20%20%20%20%20A%5BPod%20IP%3A%2010.244.1.5%5D%20--%3E%20B%5BContainer%201%3Cbr%2F%3Elocalhost%3A8080%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%20C%5BContainer%202%3Cbr%2F%3Elocalhost%3A9090%5D%0A%0A%20%20%20%20%20%20%20%20D%5BPod%20IP%3A%2010.244.1.6%5D%20--%3E%20E%5BContainer%203%3Cbr%2F%3Elocalhost%3A3000%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E9%9B%86%E7%BE%A4%E7%BD%91%E7%BB%9C%22%0A%20%20%20%20%20%20%20%20F%5BService%5D%20--%3E%20A%0A%20%20%20%20%20%20%20%20F%20--%3E%20D%0A%20%20%20%20%20%20%20%20G%5BIngress%5D%20--%3E%20F%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[9]||(s[9]=[a(" Loading... ",-1)])]),_:1})),s[43]||(s[43]=k('<p><strong>网络特点：</strong></p><ul><li>每个 Pod 有唯一的 IP 地址</li><li>Pod 内容器共享网络命名空间</li><li>容器间通过 localhost 通信</li><li>Pod 间通过 Pod IP 直接通信</li></ul><h3 id="小结-pod" tabindex="-1">小结：Pod <a class="header-anchor" href="#小结-pod" aria-label="Permalink to &quot;小结：Pod&quot;">​</a></h3><p>通过这个章节，我们学会了：</p><ul><li>✅ 理解 Pod 的概念和作用</li><li>✅ 创建和管理 Pod 资源</li><li>✅ 使用 kubectl 操作 Pod</li><li>✅ 进入 Pod 执行命令和查看日志</li><li>✅ 理解 Pod 的生命周期和网络模型</li><li>✅ 排查 Pod 常见问题</li></ul><p>Pod 是 Kubernetes 的基础构建块，为后续学习 Deployment、Service 等高级概念奠定了基础。</p><h2 id="_4-deployment-自动化管理" tabindex="-1">4. Deployment（自动化管理） <a class="header-anchor" href="#_4-deployment-自动化管理" aria-label="Permalink to &quot;4. Deployment（自动化管理）&quot;">​</a></h2><p>在生产环境中，我们很少直接管理 Pod。Deployment 提供了声明式的 Pod 管理能力，包括自动扩容、滚动更新、故障恢复等功能。</p><h3 id="_4-1-为什么需要-deployment" tabindex="-1">4.1 为什么需要 Deployment <a class="header-anchor" href="#_4-1-为什么需要-deployment" aria-label="Permalink to &quot;4.1 为什么需要 Deployment&quot;">​</a></h3>',9)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-828",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22%E6%89%8B%E5%8A%A8%E7%AE%A1%E7%90%86%20Pod%20%E7%9A%84%E9%97%AE%E9%A2%98%22%0A%20%20%20%20%20%20%20%20A1%5B%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%2010%20%E4%B8%AA%20Pod%5D%20--%3E%20A2%5B%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E9%9C%80%E8%A6%81%E9%80%90%E4%B8%AA%E6%9B%BF%E6%8D%A2%5D%0A%20%20%20%20%20%20%20%20A2%20--%3E%20A3%5BPod%20%E6%95%85%E9%9A%9C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E9%87%8D%E5%90%AF%5D%0A%20%20%20%20%20%20%20%20A3%20--%3E%20A4%5B%E6%89%A9%E5%AE%B9%E7%BC%A9%E5%AE%B9%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E6%93%8D%E4%BD%9C%5D%0A%20%20%20%20%20%20%20%20A4%20--%3E%20A5%5B%E7%AE%A1%E7%90%86%E5%A4%8D%E6%9D%82%E5%BA%A6%E9%AB%98%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Deployment%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86%22%0A%20%20%20%20%20%20%20%20B1%5B%E5%A3%B0%E6%98%8E%E6%9C%9F%E6%9C%9B%E7%8A%B6%E6%80%81%5D%20--%3E%20B2%5B%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%20Pod%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20B3%5B%E8%87%AA%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0%5D%0A%20%20%20%20%20%20%20%20B3%20--%3E%20B4%5B%E8%87%AA%E5%8A%A8%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D%5D%0A%20%20%20%20%20%20%20%20B4%20--%3E%20B5%5B%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9%E5%AE%B9%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[10]||(s[10]=[a(" Loading... ",-1)])]),_:1})),s[44]||(s[44]=k(`<p><strong>Deployment 解决的问题：</strong></p><ul><li>🔄 <strong>自动故障恢复</strong>：Pod 异常时自动重建</li><li>📈 <strong>弹性伸缩</strong>：根据需求自动调整副本数</li><li>🚀 <strong>滚动更新</strong>：零停机时间的版本升级</li><li>📝 <strong>声明式管理</strong>：描述期望状态，系统自动达成</li></ul><h3 id="_4-2-创建-deployment" tabindex="-1">4.2 创建 Deployment <a class="header-anchor" href="#_4-2-创建-deployment" aria-label="Permalink to &quot;4.2 创建 Deployment&quot;">​</a></h3><h4 id="deployment-yaml" tabindex="-1">deployment.yaml <a class="header-anchor" href="#deployment-yaml" aria-label="Permalink to &quot;deployment.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><p><strong>配置解析：</strong></p><ul><li><code>replicas: 1</code> - 期望的 Pod 副本数</li><li><code>selector.matchLabels</code> - 选择器，匹配要管理的 Pod</li><li><code>template</code> - Pod 模板，定义创建的 Pod 规格</li><li><code>labels: app: hellok8s</code> - Pod 标签，与选择器对应</li></ul><h3 id="_4-3-deployment-自愈能力" tabindex="-1">4.3 Deployment 自愈能力 <a class="header-anchor" href="#_4-3-deployment-自愈能力" aria-label="Permalink to &quot;4.3 Deployment 自愈能力&quot;">​</a></h3><p><strong>部署 Deployment：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployments</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                  READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment   1/1     1            1           39s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-qlxss   1/1     Running   0          119s</span></span></code></pre></div><p><strong>测试自愈能力：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 手动删除 Pod</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment-77bffb88c5-qlxss</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pod &quot;hellok8s-deployment-77bffb88c5-qlxss&quot; deleted</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 立即查看，发现新 Pod 自动创建</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-xp8f7   1/1     Running   0          18s</span></span></code></pre></div><h3 id="_4-4-自动扩容" tabindex="-1">4.4 自动扩容 <a class="header-anchor" href="#_4-4-自动扩容" aria-label="Permalink to &quot;4.4 自动扩容&quot;">​</a></h3>`,13)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-900",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%0A%20%20%20%20participant%20Deployment%0A%20%20%20%20participant%20ReplicaSet%0A%20%20%20%20participant%20Pod%0A%0A%20%20%20%20User-%3E%3EDeployment%3A%20%E4%BF%AE%E6%94%B9%20replicas%3A%203%0A%20%20%20%20Deployment-%3E%3EReplicaSet%3A%20%E6%9B%B4%E6%96%B0%E6%9C%9F%E6%9C%9B%E5%89%AF%E6%9C%AC%E6%95%B0%0A%20%20%20%20ReplicaSet-%3E%3EPod%3A%20%E5%88%9B%E5%BB%BA%E6%96%B0%20Pod%20%E5%AE%9E%E4%BE%8B%0A%20%20%20%20Pod-%3E%3EReplicaSet%3A%20%E6%8A%A5%E5%91%8A%E7%8A%B6%E6%80%81%0A%20%20%20%20ReplicaSet-%3E%3EDeployment%3A%20%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81%0A%20%20%20%20Deployment-%3E%3EUser%3A%20%E6%89%A9%E5%AE%B9%E5%AE%8C%E6%88%90%0A"})]),fallback:i(()=>[...s[11]||(s[11]=[a(" Loading... ",-1)])]),_:1})),s[45]||(s[45]=k(`<p><strong>扩容到 3 个副本：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 修改副本数</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><p><strong>应用更改：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 观察扩容过程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --watch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-xp8f7   1/1     Running   0          5m</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-abc123  0/1     Pending   0          1s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-def456  0/1     Pending   0          1s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-abc123  1/1     Running   0          10s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-77bffb88c5-def456  1/1     Running   0          12s</span></span></code></pre></div><h3 id="_4-5-版本升级" tabindex="-1">4.5 版本升级 <a class="header-anchor" href="#_4-5-版本升级" aria-label="Permalink to &quot;4.5 版本升级&quot;">​</a></h3><p><strong>构建 v2 版本：</strong></p><h4 id="main-go-v2" tabindex="-1">main.go (v2) <a class="header-anchor" href="#main-go-v2" aria-label="Permalink to &quot;main.go (v2)&quot;">​</a></h4><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v2] Hello, Kubernetes!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>构建和推送：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v2</span></span></code></pre></div><p><strong>更新 Deployment：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 更新镜像版本</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><p><strong>应用更新：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment-66799848c4-kpc6q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试新版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v2] Hello, Kubernetes!</span></span></code></pre></div><h3 id="_4-6-滚动更新策略" tabindex="-1">4.6 滚动更新策略 <a class="header-anchor" href="#_4-6-滚动更新策略" aria-label="Permalink to &quot;4.6 滚动更新策略&quot;">​</a></h3>`,15)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-934",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20subgraph%20%22%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B%22%0A%20%20%20%20%20%20%20%20A%5B3%E4%B8%AA%20v1%20Pod%5D%20--%3E%20B%5B2%E4%B8%AA%20v1%20%2B%201%E4%B8%AA%20v2%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5B1%E4%B8%AA%20v1%20%2B%202%E4%B8%AA%20v2%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20D%5B3%E4%B8%AA%20v2%20Pod%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%22%0A%20%20%20%20%20%20%20%20E%5BmaxSurge%3A%201%5D%20--%3E%20F%5B%E6%9C%80%E5%A4%9A%E9%A2%9D%E5%A4%96%E5%88%9B%E5%BB%BA%201%20%E4%B8%AA%20Pod%5D%0A%20%20%20%20%20%20%20%20G%5BmaxUnavailable%3A%201%5D%20--%3E%20H%5B%E6%9C%80%E5%A4%9A%E5%81%9C%E6%AD%A2%201%20%E4%B8%AA%20Pod%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[12]||(s[12]=[a(" Loading... ",-1)])]),_:1})),s[46]||(s[46]=k(`<p><strong>配置滚动更新策略：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RollingUpdate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    rollingUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxSurge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 最大峰值：可以创建的超出期望 Pod 数的 Pod 数量</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxUnavailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 最大不可用：更新过程中不可用的 Pod 数量上限</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><p><strong>更新策略类型：</strong></p><ul><li><strong>RollingUpdate</strong>（默认）：逐步替换旧 Pod</li><li><strong>Recreate</strong>：先删除所有旧 Pod，再创建新 Pod</li></ul><h3 id="_4-7-版本回滚" tabindex="-1">4.7 版本回滚 <a class="header-anchor" href="#_4-7-版本回滚" aria-label="Permalink to &quot;4.7 版本回滚&quot;">​</a></h3><p><strong>查看部署历史：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rollout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># REVISION  CHANGE-CAUSE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1         &lt;none&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2         &lt;none&gt;</span></span></code></pre></div><p><strong>回滚到上一版本：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rollout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> undo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># deployment.apps/hellok8s-deployment rolled back</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment-77bffb88c5-cvm5c</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Image: guangzhengli/hellok8s:v1  # 已回滚到 v1</span></span></code></pre></div><p><strong>回滚到指定版本：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rollout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> undo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment/hellok8s-deployment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --to-revision=2</span></span></code></pre></div><h3 id="_4-8-健康检查" tabindex="-1">4.8 健康检查 <a class="header-anchor" href="#_4-8-健康检查" aria-label="Permalink to &quot;4.8 健康检查&quot;">​</a></h3><h4 id="_4-8-1-存活探针-liveness-probe" tabindex="-1">4.8.1 存活探针 (Liveness Probe) <a class="header-anchor" href="#_4-8-1-存活探针-liveness-probe" aria-label="Permalink to &quot;4.8.1 存活探针 (Liveness Probe)&quot;">​</a></h4><p>存活探针用于检测容器是否还在运行，如果检测失败，kubelet 会重启容器。</p><p><strong>带健康检查的应用 (v3)：</strong></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v3] Hello, Kubernetes!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> started </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/healthz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Since</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(started)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> duration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   w.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   w.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, duration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   w.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   w.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>配置存活探针：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:liveness</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          livenessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/healthz</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 启动后等待时间</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 检查间隔</span></span></code></pre></div><p><strong>观察重启行为：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS     AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5995ff9447-d5fbz   1/1     Running   4 (6s ago)   102s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-deployment-5995ff9447-d5fbz</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Events:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   Normal   Killing    11m (x3 over 12m)     kubelet            Container hellok8s-container failed liveness probe, will be restarted</span></span></code></pre></div><h4 id="_4-8-2-就绪探针-readiness-probe" tabindex="-1">4.8.2 就绪探针 (Readiness Probe) <a class="header-anchor" href="#_4-8-2-就绪探针-readiness-probe" aria-label="Permalink to &quot;4.8.2 就绪探针 (Readiness Probe)&quot;">​</a></h4><p>就绪探针用于检测容器是否准备好接受流量，如果检测失败，Pod 会从 Service 的负载均衡中移除。</p><p><strong>模拟有问题的版本：</strong></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[bad] Hello, Kubernetes!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/healthz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  w.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 始终返回错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>配置就绪探针：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    rollingUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxSurge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxUnavailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:bad</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/healthz</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            successThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 连续成功 5 次才认为就绪</span></span></code></pre></div><p><strong>观察滚动更新被阻止：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-66799848c4-8xzsz   1/1     Running   0          102s  # 旧版本继续运行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-66799848c4-m9dl5   1/1     Running   0          102s  # 旧版本继续运行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-9c57c7f56-rww7k    0/1     Running   0          26s   # 新版本未就绪</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-9c57c7f56-xt9tw    0/1     Running   0          26s   # 新版本未就绪</span></span></code></pre></div><h3 id="_4-9-deployment-架构图" tabindex="-1">4.9 Deployment 架构图 <a class="header-anchor" href="#_4-9-deployment-架构图" aria-label="Permalink to &quot;4.9 Deployment 架构图&quot;">​</a></h3>`,29)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1011",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Deployment%20%E6%8E%A7%E5%88%B6%E5%99%A8%22%0A%20%20%20%20%20%20%20%20A%5BDeployment%5D%20--%3E%20B%5BReplicaSet%20v1%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%20C%5BReplicaSet%20v2%5D%0A%0A%20%20%20%20%20%20%20%20B%20--%3E%20D%5BPod%20v1-1%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20E%5BPod%20v1-2%5D%0A%0A%20%20%20%20%20%20%20%20C%20--%3E%20F%5BPod%20v2-1%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20G%5BPod%20v2-2%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20H%5BPod%20v2-3%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B%22%0A%20%20%20%20%20%20%20%20I%5B%E7%94%A8%E6%88%B7%E6%9B%B4%E6%96%B0%E9%95%9C%E5%83%8F%5D%20--%3E%20J%5B%E5%88%9B%E5%BB%BA%E6%96%B0%20ReplicaSet%5D%0A%20%20%20%20%20%20%20%20J%20--%3E%20K%5B%E9%80%90%E6%AD%A5%E5%88%9B%E5%BB%BA%E6%96%B0%20Pod%5D%0A%20%20%20%20%20%20%20%20K%20--%3E%20L%5B%E9%80%90%E6%AD%A5%E5%88%A0%E9%99%A4%E6%97%A7%20Pod%5D%0A%20%20%20%20%20%20%20%20L%20--%3E%20M%5B%E6%9B%B4%E6%96%B0%E5%AE%8C%E6%88%90%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[13]||(s[13]=[a(" Loading... ",-1)])]),_:1})),s[47]||(s[47]=k('<p><strong>组件关系：</strong></p><ul><li><strong>Deployment</strong>：管理 ReplicaSet 的生命周期</li><li><strong>ReplicaSet</strong>：确保指定数量的 Pod 副本运行</li><li><strong>Pod</strong>：实际运行的应用实例</li></ul><h3 id="_4-10-常用命令" tabindex="-1">4.10 常用命令 <a class="header-anchor" href="#_4-10-常用命令" aria-label="Permalink to &quot;4.10 常用命令&quot;">​</a></h3><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td><code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;</code></td><td>快速创建 Deployment</td></tr><tr><td><code>kubectl get deployments</code></td><td>查看 Deployment 列表</td></tr><tr><td><code>kubectl describe deployment &lt;name&gt;</code></td><td>查看 Deployment 详情</td></tr><tr><td><code>kubectl scale deployment &lt;name&gt; --replicas=5</code></td><td>扩缩容</td></tr><tr><td><code>kubectl set image deployment/&lt;name&gt; &lt;container&gt;=&lt;image&gt;</code></td><td>更新镜像</td></tr><tr><td><code>kubectl rollout status deployment/&lt;name&gt;</code></td><td>查看滚动更新状态</td></tr><tr><td><code>kubectl rollout history deployment/&lt;name&gt;</code></td><td>查看更新历史</td></tr><tr><td><code>kubectl rollout undo deployment/&lt;name&gt;</code></td><td>回滚到上一版本</td></tr><tr><td><code>kubectl rollout restart deployment/&lt;name&gt;</code></td><td>重启 Deployment</td></tr></tbody></table><h3 id="小结-deployment" tabindex="-1">小结：Deployment <a class="header-anchor" href="#小结-deployment" aria-label="Permalink to &quot;小结：Deployment&quot;">​</a></h3><p>通过这个章节，我们学会了：</p><ul><li>✅ 理解 Deployment 的作用和优势</li><li>✅ 创建和管理 Deployment 资源</li><li>✅ 实现自动扩缩容和故障恢复</li><li>✅ 配置滚动更新策略</li><li>✅ 使用健康检查保证服务可用性</li><li>✅ 进行版本升级和回滚操作</li></ul><p>Deployment 是 Kubernetes 中最重要的工作负载资源，为应用提供了生产级的部署和管理能力。</p><h2 id="_5-service-服务发现与负载均衡" tabindex="-1">5. Service（服务发现与负载均衡） <a class="header-anchor" href="#_5-service-服务发现与负载均衡" aria-label="Permalink to &quot;5. Service（服务发现与负载均衡）&quot;">​</a></h2><p>Service 解决了 Pod IP 地址不稳定和负载均衡的问题，为一组 Pod 提供稳定的网络访问入口。</p><h3 id="_5-1-为什么需要-service" tabindex="-1">5.1 为什么需要 Service <a class="header-anchor" href="#_5-1-为什么需要-service" aria-label="Permalink to &quot;5.1 为什么需要 Service&quot;">​</a></h3>',11)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1171",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22%E6%B2%A1%E6%9C%89%20Service%20%E7%9A%84%E9%97%AE%E9%A2%98%22%0A%20%20%20%20%20%20%20%20A1%5BPod%20IP%20%E4%BC%9A%E5%8F%98%E5%8C%96%5D%20--%3E%20A2%5B%E6%97%A0%E6%B3%95%E7%A8%B3%E5%AE%9A%E8%AE%BF%E9%97%AE%5D%0A%20%20%20%20%20%20%20%20A3%5B%E5%A4%9A%E4%B8%AA%20Pod%20%E5%89%AF%E6%9C%AC%5D%20--%3E%20A4%5B%E5%A6%82%E4%BD%95%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%3F%5D%0A%20%20%20%20%20%20%20%20A5%5BPod%20%E9%87%8D%E5%90%AF%5D%20--%3E%20A6%5BIP%20%E5%9C%B0%E5%9D%80%E6%94%B9%E5%8F%98%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Service%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%22%0A%20%20%20%20%20%20%20%20B1%5BService%20%E6%8F%90%E4%BE%9B%E7%A8%B3%E5%AE%9A%20IP%5D%20--%3E%20B2%5B%E8%87%AA%E5%8A%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20B3%5B%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%5D%0A%20%20%20%20%20%20%20%20B3%20--%3E%20B4%5B%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[14]||(s[14]=[a(" Loading... ",-1)])]),_:1})),s[48]||(s[48]=k(`<p><strong>Service 解决的问题：</strong></p><ul><li>🔗 <strong>稳定访问</strong>：为 Pod 提供不变的访问地址</li><li>⚖️ <strong>负载均衡</strong>：自动分发请求到多个 Pod</li><li>🔍 <strong>服务发现</strong>：通过 DNS 名称访问服务</li><li>🏥 <strong>健康检查</strong>：只向就绪的 Pod 转发流量</li></ul><h3 id="_5-2-准备测试环境" tabindex="-1">5.2 准备测试环境 <a class="header-anchor" href="#_5-2-准备测试环境" aria-label="Permalink to &quot;5.2 准备测试环境&quot;">​</a></h3><p>首先创建一个返回主机名的应用版本：</p><h4 id="main-go-v3" tabindex="-1">main.go (v3) <a class="header-anchor" href="#main-go-v3" aria-label="Permalink to &quot;main.go (v3)&quot;">​</a></h4><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v3] Hello, Kubernetes!, From host: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, host))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>构建和部署：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guangzhengli/hellok8s:v3</span></span></code></pre></div><h4 id="deployment-yaml-v3" tabindex="-1">deployment.yaml (v3) <a class="header-anchor" href="#deployment-yaml-v3" aria-label="Permalink to &quot;deployment.yaml (v3)&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><h3 id="_5-3-clusterip-service" tabindex="-1">5.3 ClusterIP Service <a class="header-anchor" href="#_5-3-clusterip-service" aria-label="Permalink to &quot;5.3 ClusterIP Service&quot;">​</a></h3><p>ClusterIP 是默认的 Service 类型，只能在集群内部访问。</p><h4 id="service-hellok8s-clusterip-yaml" tabindex="-1">service-hellok8s-clusterip.yaml <a class="header-anchor" href="#service-hellok8s-clusterip-yaml" aria-label="Permalink to &quot;service-hellok8s-clusterip.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 选择标签为 app: hellok8s 的 Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Service 端口</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Pod 端口</span></span></code></pre></div><p><strong>部署和测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service-hellok8s-clusterip.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 Service 和 Endpoints</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># service-hellok8s-clusterip   ClusterIP   10.104.96.153   &lt;none&gt;        3000/TCP   10s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoints</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                         ENDPOINTS                                          AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># service-hellok8s-clusterip   172.17.0.10:3000,172.17.0.2:3000,172.17.0.3:3000   10s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE    IP           NODE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-24lw5   1/1     Running   0          112s   172.17.0.7   minikube</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-9g94t   1/1     Running   0          112s   172.17.0.3   minikube</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-9gm8r   1/1     Running   0          112s   172.17.0.2   minikube</span></span></code></pre></div><h3 id="_5-4-service-工作原理" tabindex="-1">5.4 Service 工作原理 <a class="header-anchor" href="#_5-4-service-工作原理" aria-label="Permalink to &quot;5.4 Service 工作原理&quot;">​</a></h3>`,17)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1232",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Service%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%22%0A%20%20%20%20%20%20%20%20A%5BClient%20Request%5D%20--%3E%20B%5BService%3Cbr%2F%3E10.104.96.153%3A3000%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5BPod%201%3Cbr%2F%3E172.17.0.2%3A3000%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20D%5BPod%202%3Cbr%2F%3E172.17.0.3%3A3000%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20E%5BPod%203%3Cbr%2F%3E172.17.0.7%3A3000%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Endpoints%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%22%0A%20%20%20%20%20%20%20%20F%5BPod%20%E5%88%9B%E5%BB%BA%2F%E5%88%A0%E9%99%A4%5D%20--%3E%20G%5BEndpoints%20%E6%8E%A7%E5%88%B6%E5%99%A8%5D%0A%20%20%20%20%20%20%20%20G%20--%3E%20H%5B%E6%9B%B4%E6%96%B0%20Endpoints%20%E5%88%97%E8%A1%A8%5D%0A%20%20%20%20%20%20%20%20H%20--%3E%20I%5BService%20%E9%87%8D%E6%96%B0%E8%B7%AF%E7%94%B1%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[15]||(s[15]=[a(" Loading... ",-1)])]),_:1})),s[49]||(s[49]=k(`<p><strong>在集群内测试 Service：</strong></p><p>创建一个测试 Pod：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 nginx 容器内测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.104</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.96.153:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-9gm8r</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.104</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.96.153:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-9g94t</span></span></code></pre></div><p>可以看到每次请求返回不同的主机名，说明 Service 在自动负载均衡。</p><h3 id="_5-5-nodeport-service" tabindex="-1">5.5 NodePort Service <a class="header-anchor" href="#_5-5-nodeport-service" aria-label="Permalink to &quot;5.5 NodePort Service&quot;">​</a></h3><p>NodePort 通过每个节点的 IP 和静态端口暴露服务，可以从集群外部访问。</p>`,7)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1250",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22NodePort%20%E6%9E%B6%E6%9E%84%22%0A%20%20%20%20%20%20%20%20A%5B%E5%A4%96%E9%83%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%5D%20--%3E%20B%5BNode%20IP%3A30000%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5BNodePort%20Service%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20D%5BClusterIP%20Service%3Cbr%2F%3E%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20E%5BPod%201%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20F%5BPod%202%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20G%5BPod%203%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[16]||(s[16]=[a(" Loading... ",-1)])]),_:1})),s[50]||(s[50]=k(`<h4 id="service-hellok8s-nodeport-yaml" tabindex="-1">service-hellok8s-nodeport.yaml <a class="header-anchor" href="#service-hellok8s-nodeport-yaml" aria-label="Permalink to &quot;service-hellok8s-nodeport.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-nodeport</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NodePort</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      nodePort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 节点端口 (30000-32767)</span></span></code></pre></div><p><strong>部署和测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service-hellok8s-nodeport.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># service-hellok8s-nodeport    NodePort    10.109.188.161   &lt;none&gt;        3000:30000/TCP   28s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取 minikube IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 192.168.59.100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从集群外部访问</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://192.168.59.100:30000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-9g94t</span></span></code></pre></div><p><strong>Docker Desktop 用户注意：</strong> 如果无法通过 Node IP 访问，使用以下命令：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service-hellok8s-nodeport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --url</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http://127.0.0.1:50896</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:50896</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-559cfdd58c-zp2pc</span></span></code></pre></div><h3 id="_5-6-loadbalancer-service" tabindex="-1">5.6 LoadBalancer Service <a class="header-anchor" href="#_5-6-loadbalancer-service" aria-label="Permalink to &quot;5.6 LoadBalancer Service&quot;">​</a></h3><p>LoadBalancer 使用云提供商的负载均衡器向外部暴露服务。</p>`,8)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1269",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22LoadBalancer%20%E6%9E%B6%E6%9E%84%22%0A%20%20%20%20%20%20%20%20A%5B%E4%BA%92%E8%81%94%E7%BD%91%E6%B5%81%E9%87%8F%5D%20--%3E%20B%5B%E4%BA%91%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8%3Cbr%2F%3EELB%2FALB%2FGCP%20LB%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5BNodePort%20Service%3Cbr%2F%3E%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20D%5BClusterIP%20Service%3Cbr%2F%3E%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20E%5BPod%201%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20F%5BPod%202%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20G%5BPod%203%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[17]||(s[17]=[a(" Loading... ",-1)])]),_:1})),s[51]||(s[51]=k(`<h4 id="service-hellok8s-loadbalancer-yaml" tabindex="-1">service-hellok8s-loadbalancer.yaml <a class="header-anchor" href="#service-hellok8s-loadbalancer-yaml" aria-label="Permalink to &quot;service-hellok8s-loadbalancer.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-loadbalancer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">LoadBalancer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><p><strong>在云环境中的效果：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                            TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)          AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># service-hellok8s-loadbalancer   LoadBalancer   10.100.200.1   52.123.45.67     3000:31234/TCP   2m</span></span></code></pre></div><blockquote><p><strong>注意：</strong> 在 minikube 中需要使用 <code>minikube tunnel</code> 来模拟 LoadBalancer，但与真实云环境有差异。</p></blockquote><h3 id="_5-7-service-类型对比" tabindex="-1">5.7 Service 类型对比 <a class="header-anchor" href="#_5-7-service-类型对比" aria-label="Permalink to &quot;5.7 Service 类型对比&quot;">​</a></h3>`,6)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1286",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20subgraph%20%22Service%20%E7%B1%BB%E5%9E%8B%E5%AF%B9%E6%AF%94%22%0A%20%20%20%20%20%20%20%20A%5BClusterIP%5D%20--%3E%20A1%5B%E9%9B%86%E7%BE%A4%E5%86%85%E9%83%A8%E8%AE%BF%E9%97%AE%3Cbr%2F%3E%E9%BB%98%E8%AE%A4%E7%B1%BB%E5%9E%8B%5D%0A%20%20%20%20%20%20%20%20B%5BNodePort%5D%20--%3E%20B1%5B%E9%80%9A%E8%BF%87%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE%3Cbr%2F%3E30000-32767%5D%0A%20%20%20%20%20%20%20%20C%5BLoadBalancer%5D%20--%3E%20C1%5B%E4%BA%91%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8%3Cbr%2F%3E%E8%87%AA%E5%8A%A8%E5%88%86%E9%85%8D%E5%A4%96%E9%83%A8IP%5D%0A%20%20%20%20%20%20%20%20D%5BExternalName%5D%20--%3E%20D1%5BDNS%20CNAME%20%E6%98%A0%E5%B0%84%3Cbr%2F%3E%E6%97%A0%E4%BB%A3%E7%90%86%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%22%0A%20%20%20%20%20%20%20%20E%5B%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%5D%20--%3E%20A%0A%20%20%20%20%20%20%20%20F%5B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%5D%20--%3E%20B%0A%20%20%20%20%20%20%20%20G%5B%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%5D%20--%3E%20C%0A%20%20%20%20%20%20%20%20H%5B%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1%E6%98%A0%E5%B0%84%5D%20--%3E%20D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[18]||(s[18]=[a(" Loading... ",-1)])]),_:1})),s[52]||(s[52]=k(`<table><thead><tr><th>Service 类型</th><th>访问方式</th><th>使用场景</th><th>外部访问</th></tr></thead><tbody><tr><td><strong>ClusterIP</strong></td><td>集群内部 IP</td><td>内部服务通信</td><td>❌</td></tr><tr><td><strong>NodePort</strong></td><td>节点 IP + 端口</td><td>开发测试</td><td>✅</td></tr><tr><td><strong>LoadBalancer</strong></td><td>云负载均衡器</td><td>生产环境</td><td>✅</td></tr><tr><td><strong>ExternalName</strong></td><td>DNS CNAME</td><td>外部服务映射</td><td>N/A</td></tr></tbody></table><h3 id="_5-8-service-发现" tabindex="-1">5.8 Service 发现 <a class="header-anchor" href="#_5-8-service-发现" aria-label="Permalink to &quot;5.8 Service 发现&quot;">​</a></h3><p>Kubernetes 提供了多种服务发现机制：</p><h4 id="_5-8-1-环境变量" tabindex="-1">5.8.1 环境变量 <a class="header-anchor" href="#_5-8-1-环境变量" aria-label="Permalink to &quot;5.8.1 环境变量&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HELLOK8S</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SERVICE_HELLOK8S_CLUSTERIP_SERVICE_HOST=10.104.96.153</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SERVICE_HELLOK8S_CLUSTERIP_SERVICE_PORT=3000</span></span></code></pre></div><h4 id="_5-8-2-dns-解析" tabindex="-1">5.8.2 DNS 解析 <a class="header-anchor" href="#_5-8-2-dns-解析" aria-label="Permalink to &quot;5.8.2 DNS 解析&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nslookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Name: service-hellok8s-clusterip.default.svc.cluster.local</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Address: 10.104.96.153</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 直接通过服务名访问</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service-hellok8s-clusterip:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-24lw5</span></span></code></pre></div><p><strong>DNS 命名规则：</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span></span></code></pre></div><h3 id="_5-9-service-网络模型" tabindex="-1">5.9 Service 网络模型 <a class="header-anchor" href="#_5-9-service-网络模型" aria-label="Permalink to &quot;5.9 Service 网络模型&quot;">​</a></h3>`,10)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1384",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Kubernetes%20%E7%BD%91%E7%BB%9C%E5%B1%82%E6%AC%A1%22%0A%20%20%20%20%20%20%20%20A%5BIngress%20Controller%5D%20--%3E%20B%5BService%20Layer%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5BPod%20Network%5D%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22Service%20Layer%22%0A%20%20%20%20%20%20%20%20%20%20%20%20D%5BClusterIP%20Service%5D%20--%3E%20E%5BEndpoints%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20F%5BNodePort%20Service%5D%20--%3E%20D%0A%20%20%20%20%20%20%20%20%20%20%20%20G%5BLoadBalancer%20Service%5D%20--%3E%20F%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22Pod%20Network%22%0A%20%20%20%20%20%20%20%20%20%20%20%20H%5BPod%201%3A%2010.244.1.5%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20I%5BPod%202%3A%2010.244.1.6%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20J%5BPod%203%3A%2010.244.1.7%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20E%20--%3E%20H%0A%20%20%20%20%20%20%20%20E%20--%3E%20I%0A%20%20%20%20%20%20%20%20E%20--%3E%20J%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[19]||(s[19]=[a(" Loading... ",-1)])]),_:1})),s[53]||(s[53]=k(`<h3 id="_5-10-service-高级特性" tabindex="-1">5.10 Service 高级特性 <a class="header-anchor" href="#_5-10-service-高级特性" aria-label="Permalink to &quot;5.10 Service 高级特性&quot;">​</a></h3><h4 id="_5-10-1-会话亲和性" tabindex="-1">5.10.1 会话亲和性 <a class="header-anchor" href="#_5-10-1-会话亲和性" aria-label="Permalink to &quot;5.10.1 会话亲和性&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-session</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  sessionAffinity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClientIP</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 基于客户端 IP 的会话保持</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><h4 id="_5-10-2-多端口服务" tabindex="-1">5.10.2 多端口服务 <a class="header-anchor" href="#_5-10-2-多端口服务" aria-label="Permalink to &quot;5.10.2 多端口服务&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-multiport</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3443</span></span></code></pre></div><h4 id="_5-10-3-无头服务-headless-service" tabindex="-1">5.10.3 无头服务 (Headless Service) <a class="header-anchor" href="#_5-10-3-无头服务-headless-service" aria-label="Permalink to &quot;5.10.3 无头服务 (Headless Service)&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-headless</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  clusterIP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">None</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 无头服务</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><p>无头服务直接返回 Pod IP 地址，常用于有状态应用。</p><h3 id="_5-11-service-故障排查" tabindex="-1">5.11 Service 故障排查 <a class="header-anchor" href="#_5-11-service-故障排查" aria-label="Permalink to &quot;5.11 Service 故障排查&quot;">​</a></h3><p><strong>常见问题和解决方案：</strong></p><ol><li><p><strong>Service 无法访问</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 Service 配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 Endpoints</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoints</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 Pod 标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --show-labels</span></span></code></pre></div></li><li><p><strong>负载均衡不工作</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 Pod 就绪状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查就绪探针配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pod-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></li><li><p><strong>DNS 解析失败</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 DNS 解析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">po</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nslookup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查 CoreDNS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> coredns</span></span></code></pre></div></li></ol><h3 id="_5-12-service-最佳实践" tabindex="-1">5.12 Service 最佳实践 <a class="header-anchor" href="#_5-12-service-最佳实践" aria-label="Permalink to &quot;5.12 Service 最佳实践&quot;">​</a></h3>`,12)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1432",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BService%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%5D%20--%3E%20B%5B%E5%90%88%E7%90%86%E9%80%89%E6%8B%A9%20Service%20%E7%B1%BB%E5%9E%8B%5D%0A%20%20%20%20A%20--%3E%20C%5B%E9%85%8D%E7%BD%AE%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%5D%0A%20%20%20%20A%20--%3E%20D%5B%E4%BD%BF%E7%94%A8%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E6%A0%87%E7%AD%BE%5D%0A%20%20%20%20A%20--%3E%20E%5B%E7%9B%91%E6%8E%A7%20Service%20%E6%80%A7%E8%83%BD%5D%0A%0A%20%20%20%20B%20--%3E%20B1%5B%E5%86%85%E9%83%A8%E9%80%9A%E4%BF%A1%E7%94%A8%20ClusterIP%5D%0A%20%20%20%20B%20--%3E%20B2%5B%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%94%A8%20LoadBalancer%5D%0A%0A%20%20%20%20C%20--%3E%20C1%5B%E9%85%8D%E7%BD%AE%20readinessProbe%5D%0A%20%20%20%20C%20--%3E%20C2%5B%E8%AE%BE%E7%BD%AE%E5%90%88%E7%90%86%E7%9A%84%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%5D%0A%0A%20%20%20%20D%20--%3E%20D1%5B%E4%BD%BF%E7%94%A8%E8%AF%AD%E4%B9%89%E5%8C%96%E6%A0%87%E7%AD%BE%5D%0A%20%20%20%20D%20--%3E%20D2%5B%E9%81%BF%E5%85%8D%E6%A0%87%E7%AD%BE%E5%86%B2%E7%AA%81%5D%0A%0A%20%20%20%20E%20--%3E%20E1%5B%E7%9B%91%E6%8E%A7%E5%BB%B6%E8%BF%9F%E5%92%8C%E9%94%99%E8%AF%AF%E7%8E%87%5D%0A%20%20%20%20E%20--%3E%20E2%5B%E8%AE%BE%E7%BD%AE%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99%5D%0A"})]),fallback:i(()=>[...s[20]||(s[20]=[a(" Loading... ",-1)])]),_:1})),s[54]||(s[54]=k('<h3 id="小结-service" tabindex="-1">小结：Service <a class="header-anchor" href="#小结-service" aria-label="Permalink to &quot;小结：Service&quot;">​</a></h3><p>通过这个章节，我们学会了：</p><ul><li>✅ 理解 Service 的作用和重要性</li><li>✅ 掌握不同类型 Service 的使用场景</li><li>✅ 配置 ClusterIP、NodePort、LoadBalancer</li><li>✅ 理解服务发现和负载均衡机制</li><li>✅ 使用 DNS 进行服务间通信</li><li>✅ 排查 Service 常见问题</li></ul><p>Service 是 Kubernetes 网络的核心组件，为微服务架构提供了稳定可靠的服务间通信基础。</p><h2 id="_6-ingress-流量网关" tabindex="-1">6. Ingress（流量网关） <a class="header-anchor" href="#_6-ingress-流量网关" aria-label="Permalink to &quot;6. Ingress（流量网关）&quot;">​</a></h2><p>Ingress 是 Kubernetes 的 API 网关，提供 HTTP 和 HTTPS 路由功能，是集群外部访问内部服务的统一入口。</p><h3 id="_6-1-什么是-ingress" tabindex="-1">6.1 什么是 Ingress <a class="header-anchor" href="#_6-1-什么是-ingress" aria-label="Permalink to &quot;6.1 什么是 Ingress&quot;">​</a></h3>',7)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1483",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E7%9A%84%E9%97%AE%E9%A2%98%22%0A%20%20%20%20%20%20%20%20A1%5B%E5%A4%9A%E4%B8%AA%20NodePort%20Service%5D%20--%3E%20A2%5B%E7%AB%AF%E5%8F%A3%E7%AE%A1%E7%90%86%E5%A4%8D%E6%9D%82%5D%0A%20%20%20%20%20%20%20%20A3%5BLoadBalancer%20Service%5D%20--%3E%20A4%5B%E6%88%90%E6%9C%AC%E9%AB%98%E6%98%82%5D%0A%20%20%20%20%20%20%20%20A5%5B%E7%BC%BA%E4%B9%8F%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%5D%20--%3E%20A6%5B%E6%97%A0%E6%B3%95%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%2F%E8%B7%AF%E5%BE%84%E5%88%86%E5%8F%91%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Ingress%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%22%0A%20%20%20%20%20%20%20%20B1%5B%E7%BB%9F%E4%B8%80%E5%85%A5%E5%8F%A3%5D%20--%3E%20B2%5B%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%B7%AF%E7%94%B1%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20B3%5B%E5%9F%BA%E4%BA%8E%E8%B7%AF%E5%BE%84%E8%B7%AF%E7%94%B1%5D%0A%20%20%20%20%20%20%20%20B3%20--%3E%20B4%5BSSL%2FTLS%20%E7%BB%88%E7%BB%93%5D%0A%20%20%20%20%20%20%20%20B4%20--%3E%20B5%5B%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[21]||(s[21]=[a(" Loading... ",-1)])]),_:1})),s[55]||(s[55]=k(`<p><strong>Ingress 的优势：</strong></p><ul><li>🌐 <strong>统一入口</strong>：一个 IP 地址处理所有外部流量</li><li>🔀 <strong>智能路由</strong>：基于域名、路径进行流量分发</li><li>🔒 <strong>SSL 终结</strong>：集中管理 HTTPS 证书</li><li>💰 <strong>成本优化</strong>：减少 LoadBalancer 数量</li></ul><h3 id="_6-2-启用-ingress-controller" tabindex="-1">6.2 启用 Ingress Controller <a class="header-anchor" href="#_6-2-启用-ingress-controller" aria-label="Permalink to &quot;6.2 启用 Ingress Controller&quot;">​</a></h3><p>在 minikube 中启用 nginx-ingress：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addons</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅  ingress is now enabled</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证 Ingress Controller 运行状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                        READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ingress-nginx-admission-create-xxx          0/1     Completed   0          2m</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ingress-nginx-admission-patch-xxx           0/1     Completed   1          2m</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ingress-nginx-controller-xxx                1/1     Running     0          2m</span></span></code></pre></div><h3 id="_6-3-准备测试服务" tabindex="-1">6.3 准备测试服务 <a class="header-anchor" href="#_6-3-准备测试服务" aria-label="Permalink to &quot;6.3 准备测试服务&quot;">​</a></h3><p>首先清理之前的资源，然后创建测试服务：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment,service</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span></span></code></pre></div><p><strong>创建 HelloK8s 服务：</strong></p><h4 id="hellok8s-yaml-service" tabindex="-1">hellok8s.yaml (Service) <a class="header-anchor" href="#hellok8s-yaml-service" aria-label="Permalink to &quot;hellok8s.yaml (Service)&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span></code></pre></div><p><strong>创建 Nginx 服务：</strong></p><h4 id="nginx-yaml-service" tabindex="-1">nginx.yaml (Service) <a class="header-anchor" href="#nginx-yaml-service" aria-label="Permalink to &quot;nginx.yaml (Service)&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nginx-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx-container</span></span></code></pre></div><p><strong>部署服务：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-4wvmf   1/1     Running   0          55s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-qcszp   1/1     Running   0          55s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hellok8s-deployment-5d5545b69c-sn7mn   1/1     Running   0          55s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nginx-deployment-d47fd7f66-d9r7x       1/1     Running   0          34s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nginx-deployment-d47fd7f66-hp5nf       1/1     Running   0          34s</span></span></code></pre></div><h3 id="_6-4-创建-ingress-规则" tabindex="-1">6.4 创建 Ingress 规则 <a class="header-anchor" href="#_6-4-创建-ingress-规则" aria-label="Permalink to &quot;6.4 创建 Ingress 规则&quot;">​</a></h3><h4 id="ingress-yaml" tabindex="-1">ingress.yaml <a class="header-anchor" href="#ingress-yaml" aria-label="Permalink to &quot;ingress.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 关闭 HTTPS 重定向，使用 HTTP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/ssl-redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;false&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/hello</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nginx-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4000</span></span></code></pre></div><p><strong>配置解析：</strong></p><ul><li><code>path: /hello</code> - 匹配 <code>/hello</code> 前缀的请求</li><li><code>pathType: Prefix</code> - 前缀匹配模式</li><li><code>backend.service</code> - 后端服务配置</li><li><code>annotations</code> - Ingress Controller 特定配置</li></ul><h3 id="_6-5-ingress-路由规则" tabindex="-1">6.5 Ingress 路由规则 <a class="header-anchor" href="#_6-5-ingress-路由规则" aria-label="Permalink to &quot;6.5 Ingress 路由规则&quot;">​</a></h3>`,22)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1576",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Ingress%20%E8%B7%AF%E7%94%B1%E6%B5%81%E7%A8%8B%22%0A%20%20%20%20%20%20%20%20A%5B%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%5D%20--%3E%20B%7BIngress%20Controller%7D%0A%20%20%20%20%20%20%20%20B%20--%3E%7C%2Fhello%2F*%7C%20C%5BHelloK8s%20Service%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%7C%2F*%7C%20D%5BNginx%20Service%5D%0A%0A%20%20%20%20%20%20%20%20C%20--%3E%20E%5BHelloK8s%20Pod%201%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20F%5BHelloK8s%20Pod%202%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%20G%5BHelloK8s%20Pod%203%5D%0A%0A%20%20%20%20%20%20%20%20D%20--%3E%20H%5BNginx%20Pod%201%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%20I%5BNginx%20Pod%202%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[22]||(s[22]=[a(" Loading... ",-1)])]),_:1})),s[56]||(s[56]=k(`<p><strong>部署和测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME            CLASS   HOSTS   ADDRESS   PORTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hello-ingress   nginx   *                 80      16s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取 minikube IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 192.168.59.100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试路由规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://192.168.59.100/hello</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-sn7mn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://192.168.59.100/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;head&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></span></code></pre></div><h3 id="_6-6-基于域名的路由" tabindex="-1">6.6 基于域名的路由 <a class="header-anchor" href="#_6-6-基于域名的路由" aria-label="Permalink to &quot;6.6 基于域名的路由&quot;">​</a></h3><h4 id="ingress-host-yaml" tabindex="-1">ingress-host.yaml <a class="header-anchor" href="#ingress-host-yaml" aria-label="Permalink to &quot;ingress-host.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress-host</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/ssl-redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;false&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello.k8s.local</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx.k8s.local</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-nginx-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4000</span></span></code></pre></div><p><strong>配置本地 DNS：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加域名映射到 /etc/hosts</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip) hello.k8s.local nginx.k8s.local&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试基于域名的路由</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://hello.k8s.local/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-4wvmf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://nginx.k8s.local/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;head&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></span></code></pre></div><h3 id="_6-7-https-和-tls-配置" tabindex="-1">6.7 HTTPS 和 TLS 配置 <a class="header-anchor" href="#_6-7-https-和-tls-配置" aria-label="Permalink to &quot;6.7 HTTPS 和 TLS 配置&quot;">​</a></h3><p><strong>创建自签名证书：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成私钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tls.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tls.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tls.cert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 365</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -subj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /CN=hello.k8s.local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 TLS Secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hello-tls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cert=tls.cert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --key=tls.key</span></span></code></pre></div><h4 id="ingress-tls-yaml" tabindex="-1">ingress-tls.yaml <a class="header-anchor" href="#ingress-tls-yaml" aria-label="Permalink to &quot;ingress-tls.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress-tls</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello.k8s.local</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      secretName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-tls</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello.k8s.local</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><p><strong>测试 HTTPS：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress-tls.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试 HTTPS 访问（忽略证书验证）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://hello.k8s.local/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-qcszp</span></span></code></pre></div><h3 id="_6-8-ingress-高级功能" tabindex="-1">6.8 Ingress 高级功能 <a class="header-anchor" href="#_6-8-ingress-高级功能" aria-label="Permalink to &quot;6.8 Ingress 高级功能&quot;">​</a></h3><h4 id="_6-8-1-重写和重定向" tabindex="-1">6.8.1 重写和重定向 <a class="header-anchor" href="#_6-8-1-重写和重定向" aria-label="Permalink to &quot;6.8.1 重写和重定向&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress-rewrite</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/rewrite-target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/$2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/ssl-redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;false&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/api(/|$)(.*)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><h4 id="_6-8-2-限流和访问控制" tabindex="-1">6.8.2 限流和访问控制 <a class="header-anchor" href="#_6-8-2-限流和访问控制" aria-label="Permalink to &quot;6.8.2 限流和访问控制&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress-rate-limit</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/rate-limit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/rate-limit-window</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1m&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/whitelist-source-range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;10.0.0.0/8,172.16.0.0/12&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><h4 id="_6-8-3-跨域配置-cors" tabindex="-1">6.8.3 跨域配置 (CORS) <a class="header-anchor" href="#_6-8-3-跨域配置-cors" aria-label="Permalink to &quot;6.8.3 跨域配置 (CORS)&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-ingress-cors</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/enable-cors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/cors-allow-origin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nginx.ingress.kubernetes.io/cors-allow-methods</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET, POST, PUT, DELETE, OPTIONS&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/api</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-hellok8s-clusterip</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span></code></pre></div><h3 id="_6-9-ingress-controller-对比" tabindex="-1">6.9 Ingress Controller 对比 <a class="header-anchor" href="#_6-9-ingress-controller-对比" aria-label="Permalink to &quot;6.9 Ingress Controller 对比&quot;">​</a></h3>`,22)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1625",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20subgraph%20%22%E4%B8%BB%E6%B5%81%20Ingress%20Controller%22%0A%20%20%20%20%20%20%20%20A%5BNginx%20Ingress%5D%20--%3E%20A1%5B%E6%9C%80%E6%B5%81%E8%A1%8C%3Cbr%2F%3E%E5%8A%9F%E8%83%BD%E4%B8%B0%E5%AF%8C%5D%0A%20%20%20%20%20%20%20%20B%5BTraefik%5D%20--%3E%20B1%5B%E8%87%AA%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%3Cbr%2F%3E%E7%8E%B0%E4%BB%A3%E5%8C%96%E7%95%8C%E9%9D%A2%5D%0A%20%20%20%20%20%20%20%20C%5BHAProxy%20Ingress%5D%20--%3E%20C1%5B%E9%AB%98%E6%80%A7%E8%83%BD%3Cbr%2F%3E%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%89%B9%E6%80%A7%5D%0A%20%20%20%20%20%20%20%20D%5BIstio%20Gateway%5D%20--%3E%20D1%5B%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%3Cbr%2F%3E%E9%AB%98%E7%BA%A7%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86%5D%0A%20%20%20%20%20%20%20%20E%5BKong%20Ingress%5D%20--%3E%20E1%5BAPI%20%E7%BD%91%E5%85%B3%3Cbr%2F%3E%E6%8F%92%E4%BB%B6%E7%94%9F%E6%80%81%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E9%80%89%E6%8B%A9%E6%A0%87%E5%87%86%22%0A%20%20%20%20%20%20%20%20F%5B%E6%80%A7%E8%83%BD%E8%A6%81%E6%B1%82%5D%20--%3E%20G%5B%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82%5D%0A%20%20%20%20%20%20%20%20G%20--%3E%20H%5B%E7%94%9F%E6%80%81%E5%85%BC%E5%AE%B9%E6%80%A7%5D%0A%20%20%20%20%20%20%20%20H%20--%3E%20I%5B%E8%BF%90%E7%BB%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[23]||(s[23]=[a(" Loading... ",-1)])]),_:1})),s[57]||(s[57]=k(`<table><thead><tr><th>Ingress Controller</th><th>优势</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Nginx Ingress</strong></td><td>成熟稳定、功能丰富</td><td>通用场景、生产环境</td></tr><tr><td><strong>Traefik</strong></td><td>配置简单、自动发现</td><td>微服务、容器化环境</td></tr><tr><td><strong>HAProxy Ingress</strong></td><td>高性能、负载均衡</td><td>高并发、企业环境</td></tr><tr><td><strong>Istio Gateway</strong></td><td>服务网格、安全性</td><td>复杂微服务架构</td></tr><tr><td><strong>Kong Ingress</strong></td><td>API 管理、插件</td><td>API 网关场景</td></tr></tbody></table><h3 id="_6-10-docker-desktop-用户解决方案" tabindex="-1">6.10 Docker Desktop 用户解决方案 <a class="header-anchor" href="#_6-10-docker-desktop-用户解决方案" aria-label="Permalink to &quot;6.10 Docker Desktop 用户解决方案&quot;">​</a></h3><p>如果使用 Docker Desktop 无法通过 minikube IP 访问：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 通过 minikube 代理访问 Ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress-nginx-controller</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress-nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --url</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http://127.0.0.1:61691      # HTTP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http://127.0.0.1:61692      # HTTPS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试访问</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:61691/hello</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v3] Hello, Kubernetes!, From host: hellok8s-deployment-5d5545b69c-sn7mn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:61691/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;html&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;head&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></span></code></pre></div><h3 id="_6-11-ingress-架构图" tabindex="-1">6.11 Ingress 架构图 <a class="header-anchor" href="#_6-11-ingress-架构图" aria-label="Permalink to &quot;6.11 Ingress 架构图&quot;">​</a></h3>`,5)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1708",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Ingress%20%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84%22%0A%20%20%20%20%20%20%20%20A%5BInternet%5D%20--%3E%20B%5BLoad%20Balancer%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5BIngress%20Controller%3Cbr%2F%3Enginx-ingress%5D%0A%0A%20%20%20%20%20%20%20%20C%20--%3E%20D%7BIngress%20Rules%7D%0A%20%20%20%20%20%20%20%20D%20--%3E%7Chello.k8s.local%2Fapi%7C%20E%5BHelloK8s%20Service%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%7Cnginx.k8s.local%2F*%7C%20F%5BNginx%20Service%5D%0A%20%20%20%20%20%20%20%20D%20--%3E%7Capp.k8s.local%2Fadmin%7C%20G%5BAdmin%20Service%5D%0A%0A%20%20%20%20%20%20%20%20E%20--%3E%20H%5BHelloK8s%20Pods%5D%0A%20%20%20%20%20%20%20%20F%20--%3E%20I%5BNginx%20Pods%5D%0A%20%20%20%20%20%20%20%20G%20--%3E%20J%5BAdmin%20Pods%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22%E9%85%8D%E7%BD%AE%E7%BB%84%E4%BB%B6%22%0A%20%20%20%20%20%20%20%20K%5BIngress%20Resource%5D%20--%3E%20L%5B%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%5D%0A%20%20%20%20%20%20%20%20M%5BTLS%20Secret%5D%20--%3E%20N%5BHTTPS%20%E8%AF%81%E4%B9%A6%5D%0A%20%20%20%20%20%20%20%20O%5BConfigMap%5D%20--%3E%20P%5BController%20%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[24]||(s[24]=[a(" Loading... ",-1)])]),_:1})),s[58]||(s[58]=e("h3",{id:"_6-12-ingress-最佳实践",tabindex:"-1"},[a("6.12 Ingress 最佳实践 "),e("a",{class:"header-anchor",href:"#_6-12-ingress-最佳实践","aria-label":'Permalink to "6.12 Ingress 最佳实践"'},"​")],-1)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1712",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5BIngress%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%5D%20--%3E%20B%5B%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%5D%0A%20%20%20%20A%20--%3E%20C%5B%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%5D%0A%20%20%20%20A%20--%3E%20D%5B%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6%5D%0A%20%20%20%20A%20--%3E%20E%5B%E8%AF%81%E4%B9%A6%E7%AE%A1%E7%90%86%5D%0A%0A%20%20%20%20B%20--%3E%20B1%5B%E5%90%AF%E7%94%A8%20TLS%5D%0A%20%20%20%20B%20--%3E%20B2%5B%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%5D%0A%20%20%20%20B%20--%3E%20B3%5B%E9%99%90%E6%B5%81%E4%BF%9D%E6%8A%A4%5D%0A%0A%20%20%20%20C%20--%3E%20C1%5B%E5%90%AF%E7%94%A8%20Gzip%20%E5%8E%8B%E7%BC%A9%5D%0A%20%20%20%20C%20--%3E%20C2%5B%E9%85%8D%E7%BD%AE%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%5D%0A%20%20%20%20C%20--%3E%20C3%5B%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BC%98%E5%8C%96%5D%0A%0A%20%20%20%20D%20--%3E%20D1%5B%E7%9B%91%E6%8E%A7%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%5D%0A%20%20%20%20D%20--%3E%20D2%5B%E9%94%99%E8%AF%AF%E7%8E%87%E5%91%8A%E8%AD%A6%5D%0A%20%20%20%20D%20--%3E%20D3%5B%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7%5D%0A%0A%20%20%20%20E%20--%3E%20E1%5B%E4%BD%BF%E7%94%A8%20cert-manager%5D%0A%20%20%20%20E%20--%3E%20E2%5B%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F%5D%0A%20%20%20%20E%20--%3E%20E3%5B%E8%AF%81%E4%B9%A6%E8%BD%AE%E6%8D%A2%5D%0A"})]),fallback:i(()=>[...s[25]||(s[25]=[a(" Loading... ",-1)])]),_:1})),s[59]||(s[59]=k(`<p><strong>推荐配置：</strong></p><ol><li><p><strong>安全配置</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/ssl-redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/force-ssl-redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/hsts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span></code></pre></div></li><li><p><strong>性能优化</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/enable-gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/proxy-body-size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;50m&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/proxy-connect-timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;600&#39;</span></span></code></pre></div></li><li><p><strong>监控配置</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/enable-access-log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx.ingress.kubernetes.io/configuration-snippet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    more_set_headers &quot;X-Request-ID: $req_id&quot;;</span></span></code></pre></div></li></ol><h3 id="小结-ingress" tabindex="-1">小结：Ingress <a class="header-anchor" href="#小结-ingress" aria-label="Permalink to &quot;小结：Ingress&quot;">​</a></h3><p>通过这个章节，我们学会了：</p><ul><li>✅ 理解 Ingress 的作用和架构</li><li>✅ 启用和配置 Ingress Controller</li><li>✅ 创建基于路径和域名的路由规则</li><li>✅ 配置 HTTPS 和 TLS 证书</li><li>✅ 使用 Ingress 高级功能</li><li>✅ 选择合适的 Ingress Controller</li></ul><p>Ingress 是 Kubernetes 集群的流量入口，为微服务提供了统一的访问网关和路由管理能力。</p><h2 id="_7-配置管理-namespace、configmap、secret" tabindex="-1">7. 配置管理（Namespace、ConfigMap、Secret） <a class="header-anchor" href="#_7-配置管理-namespace、configmap、secret" aria-label="Permalink to &quot;7. 配置管理（Namespace、ConfigMap、Secret）&quot;">​</a></h2><p>在实际项目中，我们需要管理不同环境的配置、敏感信息和资源隔离。Kubernetes 提供了 Namespace、ConfigMap 和 Secret 来解决这些问题。</p><h3 id="_7-1-namespace-命名空间" tabindex="-1">7.1 Namespace（命名空间） <a class="header-anchor" href="#_7-1-namespace-命名空间" aria-label="Permalink to &quot;7.1 Namespace（命名空间）&quot;">​</a></h3><p>Namespace 提供了资源隔离机制，可以在同一集群中创建多个虚拟集群。</p>`,10)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1789",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20%22Kubernetes%20%E9%9B%86%E7%BE%A4%22%0A%20%20%20%20%20%20%20%20subgraph%20%22default%20namespace%22%0A%20%20%20%20%20%20%20%20%20%20%20%20A%5Bhellok8s-pod%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20B%5Bnginx-pod%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22dev%20namespace%22%0A%20%20%20%20%20%20%20%20%20%20%20%20C%5Bhellok8s-dev-pod%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20D%5Bmysql-dev-pod%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22prod%20namespace%22%0A%20%20%20%20%20%20%20%20%20%20%20%20E%5Bhellok8s-prod-pod%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20F%5Bmysql-prod-pod%5D%0A%20%20%20%20%20%20%20%20end%0A%0A%20%20%20%20%20%20%20%20subgraph%20%22kube-system%20namespace%22%0A%20%20%20%20%20%20%20%20%20%20%20%20G%5Bcoredns%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20H%5Bkube-proxy%5D%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[26]||(s[26]=[a(" Loading... ",-1)])]),_:1})),s[60]||(s[60]=k(`<p><strong>创建 Namespace：</strong></p><h4 id="namespaces-yaml" tabindex="-1">namespaces.yaml <a class="header-anchor" href="#namespaces-yaml" aria-label="Permalink to &quot;namespaces.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespaces.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespaces</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME              STATUS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># default           Active   215d</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dev               Active   2m44s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># test              Active   2m44s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kube-system       Active   215d</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kube-public       Active   215d</span></span></code></pre></div><p><strong>在指定 Namespace 中操作：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 dev namespace 中创建资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看指定 namespace 的资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换默认 namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-context</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --current</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --namespace=dev</span></span></code></pre></div><h3 id="_7-2-configmap-配置映射" tabindex="-1">7.2 ConfigMap（配置映射） <a class="header-anchor" href="#_7-2-configmap-配置映射" aria-label="Permalink to &quot;7.2 ConfigMap（配置映射）&quot;">​</a></h3><p>ConfigMap 用于存储非敏感的配置数据，将配置与应用代码分离。</p><p><strong>应用示例（v4 版本）：</strong></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbURL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DB_URL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v4] Hello, Kubernetes! From host: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, Get Database Connect URL: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, host, dbURL))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>创建不同环境的 ConfigMap：</strong></p><h4 id="hellok8s-config-dev-yaml" tabindex="-1">hellok8s-config-dev.yaml <a class="header-anchor" href="#hellok8s-config-dev-yaml" aria-label="Permalink to &quot;hellok8s-config-dev.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://DB_ADDRESS_DEV&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  LOG_LEVEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;debug&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  CACHE_SIZE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;100&#39;</span></span></code></pre></div><h4 id="hellok8s-config-prod-yaml" tabindex="-1">hellok8s-config-prod.yaml <a class="header-anchor" href="#hellok8s-config-prod-yaml" aria-label="Permalink to &quot;hellok8s-config-prod.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://DB_ADDRESS_PROD&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  LOG_LEVEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;info&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  CACHE_SIZE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1000&#39;</span></span></code></pre></div><p><strong>在 Pod 中使用 ConfigMap：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_URL</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            configMapKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_URL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">LOG_LEVEL</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            configMapKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">LOG_LEVEL</span></span></code></pre></div><p><strong>部署和测试：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在不同 namespace 创建不同配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-config-dev.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-config-prod.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 部署应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试不同环境的配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v4] Hello, Kubernetes! From host: hellok8s-pod, Get Database Connect URL: http://DB_ADDRESS_DEV</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:3000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prod</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [v4] Hello, Kubernetes! From host: hellok8s-pod, Get Database Connect URL: http://DB_ADDRESS_PROD</span></span></code></pre></div><h3 id="_7-3-secret-密钥管理" tabindex="-1">7.3 Secret（密钥管理） <a class="header-anchor" href="#_7-3-secret-密钥管理" aria-label="Permalink to &quot;7.3 Secret（密钥管理）&quot;">​</a></h3><p>Secret 用于存储敏感信息，如密码、令牌、密钥等。</p>`,21)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1837",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20subgraph%20%22ConfigMap%20vs%20Secret%22%0A%20%20%20%20%20%20%20%20A%5BConfigMap%5D%20--%3E%20A1%5B%E9%9D%9E%E6%95%8F%E6%84%9F%E9%85%8D%E7%BD%AE%3Cbr%2F%3E%E6%98%8E%E6%96%87%E5%AD%98%E5%82%A8%5D%0A%20%20%20%20%20%20%20%20B%5BSecret%5D%20--%3E%20B1%5B%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%3Cbr%2F%3EBase64%E7%BC%96%E7%A0%81%5D%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20%22Secret%20%E7%B1%BB%E5%9E%8B%22%0A%20%20%20%20%20%20%20%20C%5BOpaque%5D%20--%3E%20C1%5B%E9%80%9A%E7%94%A8%E5%AF%86%E9%92%A5%5D%0A%20%20%20%20%20%20%20%20D%5Bkubernetes.io%2Ftls%5D%20--%3E%20D1%5BTLS%20%E8%AF%81%E4%B9%A6%5D%0A%20%20%20%20%20%20%20%20E%5Bkubernetes.io%2Fdockerconfigjson%5D%20--%3E%20E1%5BDocker%20%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[27]||(s[27]=[a(" Loading... ",-1)])]),_:1})),s[61]||(s[61]=k(`<p><strong>创建 Secret：</strong></p><h4 id="方法-1-命令行创建" tabindex="-1">方法 1：命令行创建 <a class="header-anchor" href="#方法-1-命令行创建" aria-label="Permalink to &quot;方法 1：命令行创建&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建通用 Secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --from-literal=DB_PASSWORD=my-secret-password</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --from-literal=API_KEY=abc123def456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 TLS Secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-tls-secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --cert=path/to/cert/file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --key=path/to/key/file</span></span></code></pre></div><h4 id="方法-2-yaml-文件创建" tabindex="-1">方法 2：YAML 文件创建 <a class="header-anchor" href="#方法-2-yaml-文件创建" aria-label="Permalink to &quot;方法 2：YAML 文件创建&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DB_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bXktc2VjcmV0LXBhc3N3b3Jk</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # base64 编码</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  API_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">YWJjMTIzZGVmNDU2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # base64 编码</span></span></code></pre></div><p><strong>Base64 编码/解码：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my-secret-password&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># bXktc2VjcmV0LXBhc3N3b3JkCg==</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bXktc2VjcmV0LXBhc3N3b3JkCg==&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># my-secret-password</span></span></code></pre></div><p><strong>在应用中使用 Secret：</strong></p><p><strong>应用代码（v5 版本）：</strong></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbPassword </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DB_PASSWORD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiKey </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API_KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[v5] Hello, Kubernetes! From host: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, DB Password: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, API Key: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, host, dbPassword, apiKey))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandleFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListenAndServe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Pod 配置：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s:v5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            secretKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">API_KEY</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            secretKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hellok8s-secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">API_KEY</span></span></code></pre></div><h3 id="_7-4-配置管理最佳实践" tabindex="-1">7.4 配置管理最佳实践 <a class="header-anchor" href="#_7-4-配置管理最佳实践" aria-label="Permalink to &quot;7.4 配置管理最佳实践&quot;">​</a></h3>`,13)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1867",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%5D%20--%3E%20B%5B%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB%5D%0A%20%20%20%20A%20--%3E%20C%5B%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%5D%0A%20%20%20%20A%20--%3E%20D%5B%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%5D%0A%20%20%20%20A%20--%3E%20E%5B%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%5D%0A%0A%20%20%20%20B%20--%3E%20B1%5B%E4%BD%BF%E7%94%A8%20Namespace%20%E5%88%86%E7%A6%BB%E7%8E%AF%E5%A2%83%5D%0A%20%20%20%20B%20--%3E%20B2%5B%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE%5D%0A%0A%20%20%20%20C%20--%3E%20C1%5B%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E7%94%A8%20Secret%5D%0A%20%20%20%20C%20--%3E%20C2%5B%E6%9C%80%E5%B0%8F%E6%9D%83%E9%99%90%E5%8E%9F%E5%88%99%5D%0A%20%20%20%20C%20--%3E%20C3%5B%E5%AE%9A%E6%9C%9F%E8%BD%AE%E6%8D%A2%E5%AF%86%E9%92%A5%5D%0A%0A%20%20%20%20D%20--%3E%20D1%5B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%89%88%E6%9C%AC%E5%8C%96%5D%0A%20%20%20%20D%20--%3E%20D2%5B%E5%8F%98%E6%9B%B4%E8%AE%B0%E5%BD%95%E8%BF%BD%E8%B8%AA%5D%0A%0A%20%20%20%20E%20--%3E%20E1%5BCI%2FCD%20%E9%9B%86%E6%88%90%5D%0A%20%20%20%20E%20--%3E%20E2%5B%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81%5D%0A"})]),fallback:i(()=>[...s[28]||(s[28]=[a(" Loading... ",-1)])]),_:1})),s[62]||(s[62]=k(`<p><strong>推荐的目录结构：</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>k8s-configs/</span></span>
<span class="line"><span>├── base/</span></span>
<span class="line"><span>│   ├── deployment.yaml</span></span>
<span class="line"><span>│   ├── service.yaml</span></span>
<span class="line"><span>│   └── configmap.yaml</span></span>
<span class="line"><span>├── environments/</span></span>
<span class="line"><span>│   ├── dev/</span></span>
<span class="line"><span>│   │   ├── namespace.yaml</span></span>
<span class="line"><span>│   │   ├── configmap-dev.yaml</span></span>
<span class="line"><span>│   │   └── secret-dev.yaml</span></span>
<span class="line"><span>│   ├── test/</span></span>
<span class="line"><span>│   │   ├── namespace.yaml</span></span>
<span class="line"><span>│   │   ├── configmap-test.yaml</span></span>
<span class="line"><span>│   │   └── secret-test.yaml</span></span>
<span class="line"><span>│   └── prod/</span></span>
<span class="line"><span>│       ├── namespace.yaml</span></span>
<span class="line"><span>│       ├── configmap-prod.yaml</span></span>
<span class="line"><span>│       └── secret-prod.yaml</span></span></code></pre></div><h2 id="_8-job-和-cronjob-任务管理" tabindex="-1">8. Job 和 CronJob（任务管理） <a class="header-anchor" href="#_8-job-和-cronjob-任务管理" aria-label="Permalink to &quot;8. Job 和 CronJob（任务管理）&quot;">​</a></h2><p>对于一次性任务和定时任务，Kubernetes 提供了 Job 和 CronJob 资源。</p><h3 id="_8-1-job-一次性任务" tabindex="-1">8.1 Job（一次性任务） <a class="header-anchor" href="#_8-1-job-一次性任务" aria-label="Permalink to &quot;8.1 Job（一次性任务）&quot;">​</a></h3>`,5)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1881",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BJob%20%E5%88%9B%E5%BB%BA%5D%20--%3E%20B%5BPod%20%E5%90%AF%E5%8A%A8%5D%0A%20%20%20%20B%20--%3E%20C%7B%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%7D%0A%20%20%20%20C%20--%3E%7C%E6%88%90%E5%8A%9F%7C%20D%5BJob%20%E5%AE%8C%E6%88%90%5D%0A%20%20%20%20C%20--%3E%7C%E5%A4%B1%E8%B4%A5%7C%20E%5B%E9%87%8D%E8%AF%95%E6%89%A7%E8%A1%8C%5D%0A%20%20%20%20E%20--%3E%20B%0A%20%20%20%20D%20--%3E%20F%5BPod%20%E4%BF%9D%E7%95%99%3Cbr%2F%3E%E5%8F%AF%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%5D%0A"})]),fallback:i(()=>[...s[29]||(s[29]=[a(" Loading... ",-1)])]),_:1})),s[63]||(s[63]=k(`<h4 id="hello-job-yaml" tabindex="-1">hello-job.yaml <a class="header-anchor" href="#hello-job-yaml" aria-label="Permalink to &quot;hello-job.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Job</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-job</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  parallelism</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 并发执行数</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  completions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 总完成数</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      restartPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OnFailure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">busybox</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/bin/sh&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-c&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done&#39;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hello-job.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jobs</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME        COMPLETIONS   DURATION   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hello-job   5/5           19s        83s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAME              READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># hello-job--1-xxx   0/1     Completed   0          34s</span></span></code></pre></div><h3 id="_8-2-cronjob-定时任务" tabindex="-1">8.2 CronJob（定时任务） <a class="header-anchor" href="#_8-2-cronjob-定时任务" aria-label="Permalink to &quot;8.2 CronJob（定时任务）&quot;">​</a></h3><h4 id="hello-cronjob-yaml" tabindex="-1">hello-cronjob.yaml <a class="header-anchor" href="#hello-cronjob-yaml" aria-label="Permalink to &quot;hello-cronjob.yaml&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CronJob</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello-cronjob</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  schedule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*/1 * * * *&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 每分钟执行一次</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  jobTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          restartPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OnFailure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">busybox</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/bin/sh&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-c&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;date; echo Hello from Kubernetes CronJob&#39;</span></span></code></pre></div><p><strong>Cron 表达式说明：</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># ┌───────────── 分钟 (0 - 59)</span></span>
<span class="line"><span># │ ┌───────────── 小时 (0 - 23)</span></span>
<span class="line"><span># │ │ ┌───────────── 日 (1 - 31)</span></span>
<span class="line"><span># │ │ │ ┌───────────── 月 (1 - 12)</span></span>
<span class="line"><span># │ │ │ │ ┌───────────── 星期 (0 - 6，0=周日)</span></span>
<span class="line"><span># │ │ │ │ │</span></span>
<span class="line"><span># * * * * *</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 常用示例：</span></span>
<span class="line"><span># &quot;0 2 * * *&quot;     # 每天凌晨2点</span></span>
<span class="line"><span># &quot;0 */6 * * *&quot;   # 每6小时</span></span>
<span class="line"><span># &quot;0 0 1 * *&quot;     # 每月1号</span></span>
<span class="line"><span># &quot;0 0 * * 1&quot;     # 每周一</span></span></code></pre></div><h2 id="_9-helm-包管理器" tabindex="-1">9. Helm（包管理器） <a class="header-anchor" href="#_9-helm-包管理器" aria-label="Permalink to &quot;9. Helm（包管理器）&quot;">​</a></h2><p>Helm 是 Kubernetes 的包管理器，简化了复杂应用的部署和管理。</p><h3 id="_9-1-安装-helm" tabindex="-1">9.1 安装 Helm <a class="header-anchor" href="#_9-1-安装-helm" aria-label="Permalink to &quot;9.1 安装 Helm&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># macOS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span></code></pre></div><h3 id="_9-2-使用-helm-chart" tabindex="-1">9.2 使用 Helm Chart <a class="header-anchor" href="#_9-2-使用-helm-chart" aria-label="Permalink to &quot;9.2 使用 Helm Chart&quot;">​</a></h3><p><strong>快速体验：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加官方仓库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://charts.helm.sh/stable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索 Chart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stable/nginx-ingress</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看已安装的应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 卸载应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-nginx</span></span></code></pre></div><h3 id="_9-3-创建自定义-chart" tabindex="-1">9.3 创建自定义 Chart <a class="header-anchor" href="#_9-3-创建自定义-chart" aria-label="Permalink to &quot;9.3 创建自定义 Chart&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 Chart 模板</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s-chart</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Chart 目录结构</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hellok8s-chart/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Chart.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Chart 元信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> values.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # 默认配置值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> templates/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 模板文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> charts/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 依赖 Chart</span></span></code></pre></div><p><strong>简化的 values.yaml：</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  repository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">guangzhengli/hellok8s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IfNotPresent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello.k8s.local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">replicaCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:5432&#39;</span></span></code></pre></div><p><strong>部署和管理：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 Chart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./hellok8s-chart</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 升级应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./hellok8s-chart</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> replicaCount=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 回滚版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rollback</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看历史</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hellok8s</span></span></code></pre></div><h2 id="_10-总结与最佳实践" tabindex="-1">10. 总结与最佳实践 <a class="header-anchor" href="#_10-总结与最佳实践" aria-label="Permalink to &quot;10. 总结与最佳实践&quot;">​</a></h2><p>通过本实践教程，我们完整地学习了 Kubernetes 的核心概念和实际应用：</p><h3 id="_10-1-学习路径总结" tabindex="-1">10.1 学习路径总结 <a class="header-anchor" href="#_10-1-学习路径总结" aria-label="Permalink to &quot;10.1 学习路径总结&quot;">​</a></h3>`,24)),(n(),h(t,null,{default:i(()=>[p(l,{id:"mermaid-1936",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%E5%AE%B9%E5%99%A8%E5%8C%96%E5%9F%BA%E7%A1%80%5D%20--%3E%20B%5BPod%20%E7%AE%A1%E7%90%86%5D%0A%20%20%20%20B%20--%3E%20C%5BDeployment%20%E8%87%AA%E5%8A%A8%E5%8C%96%5D%0A%20%20%20%20C%20--%3E%20D%5BService%20%E7%BD%91%E7%BB%9C%5D%0A%20%20%20%20D%20--%3E%20E%5BIngress%20%E7%BD%91%E5%85%B3%5D%0A%20%20%20%20E%20--%3E%20F%5B%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%5D%0A%20%20%20%20F%20--%3E%20G%5B%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%5D%0A%20%20%20%20G%20--%3E%20H%5BHelm%20%E5%8C%85%E7%AE%A1%E7%90%86%5D%0A%0A%20%20%20%20A%20--%3E%20A1%5BDocker%20%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%5D%0A%20%20%20%20B%20--%3E%20B1%5B%E6%9C%80%E5%B0%8F%E9%83%A8%E7%BD%B2%E5%8D%95%E5%85%83%5D%0A%20%20%20%20C%20--%3E%20C1%5B%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0%2F%E6%89%A9%E7%BC%A9%E5%AE%B9%5D%0A%20%20%20%20D%20--%3E%20D1%5B%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%2F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%5D%0A%20%20%20%20E%20--%3E%20E1%5B%E6%B5%81%E9%87%8F%E8%B7%AF%E7%94%B1%2FSSL%E7%BB%88%E7%BB%93%5D%0A%20%20%20%20F%20--%3E%20F1%5B%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB%2F%E9%85%8D%E7%BD%AE%E5%88%86%E7%A6%BB%5D%0A%20%20%20%20G%20--%3E%20G1%5B%E6%89%B9%E5%A4%84%E7%90%86%2F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%5D%0A%20%20%20%20H%20--%3E%20H1%5B%E5%BA%94%E7%94%A8%E6%89%93%E5%8C%85%2F%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%5D%0A"})]),fallback:i(()=>[...s[30]||(s[30]=[a(" Loading... ",-1)])]),_:1})),s[64]||(s[64]=k('<h3 id="_10-2-生产环境最佳实践" tabindex="-1">10.2 生产环境最佳实践 <a class="header-anchor" href="#_10-2-生产环境最佳实践" aria-label="Permalink to &quot;10.2 生产环境最佳实践&quot;">​</a></h3><ol><li><p><strong>资源管理</strong></p><ul><li>设置资源限制和请求</li><li>使用 HPA 自动扩缩容</li><li>配置节点亲和性</li></ul></li><li><p><strong>安全配置</strong></p><ul><li>启用 RBAC 权限控制</li><li>使用 NetworkPolicy 网络隔离</li><li>定期更新镜像和集群</li></ul></li><li><p><strong>监控告警</strong></p><ul><li>部署 Prometheus + Grafana</li><li>配置应用和基础设施监控</li><li>设置关键指标告警</li></ul></li><li><p><strong>备份恢复</strong></p><ul><li>定期备份 etcd 数据</li><li>制定灾难恢复计划</li><li>测试恢复流程</li></ul></li></ol><h3 id="_10-3-进阶学习方向" tabindex="-1">10.3 进阶学习方向 <a class="header-anchor" href="#_10-3-进阶学习方向" aria-label="Permalink to &quot;10.3 进阶学习方向&quot;">​</a></h3><ul><li><strong>服务网格</strong>：Istio、Linkerd</li><li><strong>CI/CD 集成</strong>：GitOps、ArgoCD</li><li><strong>存储管理</strong>：PV、PVC、StorageClass</li><li><strong>集群管理</strong>：多集群、联邦</li><li><strong>安全加固</strong>：Pod Security Standards、OPA</li></ul><p>通过这个实践教程，你已经掌握了 Kubernetes 的核心技能，可以开始在实际项目中应用这些知识了！</p><hr><p><strong>参考资源：</strong></p><ul><li><a href="https://kubernetes.io/docs/" target="_blank" rel="noreferrer">Kubernetes 官方文档</a></li><li><a href="https://helm.sh/docs/" target="_blank" rel="noreferrer">Helm 官方文档</a></li><li><a href="https://kubernetes.io/docs/reference/kubectl/" target="_blank" rel="noreferrer">kubectl 命令参考</a></li><li><a href="https://github.com/kubernetes/examples" target="_blank" rel="noreferrer">YAML 配置示例</a></li></ul>',8))])}const u=E(g,[["render",o]]);export{D as __pageData,u as default};
